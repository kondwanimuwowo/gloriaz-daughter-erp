/* index.css */
@import "tailwindcss";

:root {
  font-family: system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;
  color: #213547;
  background-color: #ffffff;
  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

@theme {
  --color-primary-50: #fff7ed;
  --color-primary-100: #ffedd5;
  --color-primary-200: #fed7aa;
  --color-primary-300: #fdba74;
  --color-primary-400: #fb923c;
  --color-primary-500: #f97316;
  --color-primary-600: #ea580c;
  --color-primary-700: #c2410c;
  --color-primary-800: #9a3412;
  --color-primary-900: #7c2d12;
}

/* Fix button visibility */
.btn-primary {
  @apply bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200;
}

.btn-secondary {
  @apply bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-2 px-4 rounded-lg transition-colors duration-200;
}

/* Fix input fields */
.input-field {
  @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none text-gray-900;
}

/* Fix card styling */
.card {
  @apply bg-white rounded-xl shadow-sm border border-gray-200 p-6;
}

/* Ensure text is visible */
body {
  color: #1f2937;
}

/* Fix modal backdrop */
.fixed {
  position: fixed;
}

main.jsx
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)

index.html
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>gloriaz-daughter-erp</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>

package.json
{
  "name": "gloriaz-daughter-erp",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@supabase/supabase-js": "^2.86.0",
    "@tailwindcss/vite": "^4.1.17",
    "date-fns": "^4.1.0",
    "framer-motion": "^12.23.25",
    "lucide-react": "^0.555.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-hook-form": "^7.68.0",
    "react-hot-toast": "^2.6.0",
    "react-router-dom": "^7.10.0",
    "recharts": "^3.5.1",
    "tailwindcss": "^4.1.17",
    "zustand": "^5.0.9"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.22",
    "eslint": "^9.39.1",
    "eslint-plugin-react": "^7.37.5",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.5.6",
    "prettier": "^3.7.4",
    "vite": "^7.2.4"
  }
}



import { Navigate, useLocation } from "react-router-dom";
import { useAuthStore } from "../../store/useAuthStore";

export default function ProtectedRoute({ children, requiredRoles = [] }) {
  const { user, profile, loading, initialized } = useAuthStore();
  const location = useLocation();

  // Wait for auth to initialize
  if (!initialized || loading) {
    return (
      <div className="flex items-center justify-center h-screen">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading...</p>
        </div>
      </div>
    );
  }

  // Not authenticated
  if (!user) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  // Check if profile is active
  if (profile && !profile.active) {
    return (
      <div className="flex items-center justify-center h-screen bg-gray-50">
        <div className="text-center max-w-md p-8 bg-white rounded-xl shadow-lg">
          <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg
              className="w-8 h-8 text-red-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
              />
            </svg>
          </div>
          <h2 className="text-2xl font-bold text-gray-900 mb-2">
            Account Deactivated
          </h2>
          <p className="text-gray-600 mb-6">
            Your account has been deactivated. Please contact an administrator
            for assistance.
          </p>
          <button
            onClick={() => useAuthStore.getState().signOut()}
            className="btn-primary"
          >
            Sign Out
          </button>
        </div>
      </div>
    );
  }

  // Check role requirements
  if (requiredRoles.length > 0 && profile) {
    const hasRequiredRole = requiredRoles.includes(profile.role);

    if (!hasRequiredRole) {
      return (
        <div className="flex items-center justify-center h-screen bg-gray-50">
          <div className="text-center max-w-md p-8 bg-white rounded-xl shadow-lg">
            <div className="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <svg
                className="w-8 h-8 text-yellow-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                />
              </svg>
            </div>
            <h2 className="text-2xl font-bold text-gray-900 mb-2">
              Access Denied
            </h2>
            <p className="text-gray-600 mb-6">
              You don't have permission to access this page.
            </p>
            <button
              onClick={() => window.history.back()}
              className="btn-primary"
            >
              Go Back
            </button>
          </div>
        </div>
      );
    }
  }

  return children;
}


import { motion } from "framer-motion";

export default function Button({
  children,
  variant = "primary",
  onClick,
  type = "button",
  disabled = false,
  className = "",
  icon: Icon,
  loading = false,
}) {
  const variants = {
    primary: "btn-primary",
    secondary: "btn-secondary",
    danger: "bg-red-600 hover:bg-red-700 text-white",
    ghost: "bg-transparent hover:bg-gray-100 text-gray-700",
  };

  return (
    <motion.button
      whileHover={{ scale: disabled ? 1 : 1.02 }}
      whileTap={{ scale: disabled ? 1 : 0.98 }}
      type={type}
      onClick={onClick}
      disabled={disabled || loading}
      className={`${variants[variant]} ${className} ${
        disabled ? "opacity-50 cursor-not-allowed" : ""
      } flex items-center gap-2 justify-center`}
    >
      {loading ? (
        <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin" />
      ) : (
        <>
          {Icon && <Icon size={18} />}
          {children}
        </>
      )}
    </motion.button>
  );
}


import { motion } from "framer-motion";

export default function Card({ children, className = "", hover = false }) {
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      whileHover={hover ? { y: -4, shadow: "lg" } : {}}
      className={`card ${className}`}
    >
      {children}
    </motion.div>
  );
}


export default function Input({ label, error, icon: Icon, ...props }) {
  return (
    <div className="w-full">
      {label && (
        <label className="block text-sm font-medium text-gray-700 mb-2">
          {label}
        </label>
      )}
      <div className="relative">
        {Icon && (
          <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
            <Icon size={20} />
          </div>
        )}
        <input
          className={`input-field ${Icon ? "pl-10" : ""} ${
            error ? "border-red-500 focus:ring-red-500" : ""
          }`}
          {...props}
        />
      </div>
      {error && <p className="mt-1 text-sm text-red-600">{error}</p>}
    </div>
  );
}


src/components/common/Button.jsx src/components/common/Card.jsx src/components/common/Input.jsx src/components/common/Modal.jsx

import { useState, useEffect } from "react";
import { useForm } from "react-hook-form";
import Input from "../common/Input";
import Button from "../common/Button";
import { User, Phone, Mail, MapPin } from "lucide-react";

export default function AddCustomerForm({ customer, onSubmit, onCancel }) {
  const [loading, setLoading] = useState(false);

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
  } = useForm({
    defaultValues: customer || {
      name: "",
      phone: "",
      email: "",
      address: "",
      notes: "",
    },
  });

  useEffect(() => {
    if (customer) {
      reset(customer);
    }
  }, [customer, reset]);

  const handleFormSubmit = async (data) => {
    setLoading(true);
    try {
      await onSubmit(data);
      if (!customer) {
        reset();
      }
    } catch (error) {
      console.error(error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit(handleFormSubmit)} className="space-y-6">
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {/* Full Name */}
        <div className="md:col-span-2">
          <Input
            label="Full Name"
            placeholder="e.g., Martha Mumba"
            icon={User}
            error={errors.name?.message}
            {...register("name", { required: "Name is required" })}
          />
        </div>

        {/* Phone */}
        <div>
          <Input
            label="Phone Number"
            type="tel"
            placeholder="+260 XXX XXX XXX"
            icon={Phone}
            error={errors.phone?.message}
            {...register("phone", { required: "Phone number is required" })}
          />
        </div>

        {/* Email */}
        <div>
          <Input
            label="Email (Optional)"
            type="email"
            placeholder="customer@email.com"
            icon={Mail}
            error={errors.email?.message}
            {...register("email", {
              pattern: {
                value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,
                message: "Invalid email address",
              },
            })}
          />
        </div>

        {/* Address */}
        <div className="md:col-span-2">
          <Input
            label="Address (Optional)"
            placeholder="Street address, city, area"
            icon={MapPin}
            {...register("address")}
          />
        </div>

        {/* Notes */}
        <div className="md:col-span-2">
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Notes (Optional)
          </label>
          <textarea
            rows={3}
            className="input-field resize-none"
            placeholder="Any additional information about the customer..."
            {...register("notes")}
          />
        </div>
      </div>

      {/* Actions */}
      <div className="flex gap-3 justify-end pt-4 border-t border-gray-200">
        <Button
          type="button"
          variant="secondary"
          onClick={onCancel}
          disabled={loading}
        >
          Cancel
        </Button>
        <Button type="submit" loading={loading}>
          {customer ? "Update Customer" : "Add Customer"}
        </Button>
      </div>
    </form>
  );
}


import { motion } from "framer-motion";
import {
  User,
  Phone,
  Mail,
  MapPin,
  ShoppingCart,
  Eye,
  Edit,
  Trash2,
} from "lucide-react";
import { format } from "date-fns";
import Button from "../common/Button";

export default function CustomerCard({ customer, onView, onEdit, onDelete }) {
  return (
    <motion.div
      initial={{ opacity: 0, scale: 0.95 }}
      animate={{ opacity: 1, scale: 1 }}
      whileHover={{ y: -4 }}
      className="bg-white rounded-xl shadow-sm border border-gray-200 p-5 hover:shadow-md transition-all duration-200"
    >
      {/* Header with Avatar */}
      <div className="flex items-start justify-between mb-4">
        <div className="flex items-center gap-3">
          <div className="w-14 h-14 bg-gradient-to-br from-primary-500 to-primary-600 rounded-full flex items-center justify-center text-white font-bold text-xl">
            {customer.name
              .split(" ")
              .map((n) => n[0])
              .join("")
              .toUpperCase()
              .slice(0, 2)}
          </div>
          <div>
            <h3 className="font-semibold text-gray-900 text-lg">
              {customer.name}
            </h3>
            <p className="text-xs text-gray-500">
              Member since {format(new Date(customer.created_at), "MMM yyyy")}
            </p>
          </div>
        </div>
      </div>

      {/* Contact Info */}
      <div className="space-y-2 mb-4 pb-4 border-b border-gray-100">
        <div className="flex items-center gap-2 text-sm text-gray-600">
          <Phone size={16} className="text-gray-400" />
          <span>{customer.phone}</span>
        </div>
        {customer.email && (
          <div className="flex items-center gap-2 text-sm text-gray-600">
            <Mail size={16} className="text-gray-400" />
            <span className="truncate">{customer.email}</span>
          </div>
        )}
        {customer.address && (
          <div className="flex items-center gap-2 text-sm text-gray-600">
            <MapPin size={16} className="text-gray-400" />
            <span className="line-clamp-1">{customer.address}</span>
          </div>
        )}
      </div>

      {/* Stats */}
      <div className="grid grid-cols-2 gap-3 mb-4">
        <div className="bg-blue-50 rounded-lg p-3">
          <p className="text-xs text-blue-600 mb-1">Total Orders</p>
          <p className="text-lg font-bold text-blue-900">
            {customer.orders?.length || 0}
          </p>
        </div>
        <div className="bg-green-50 rounded-lg p-3">
          <p className="text-xs text-green-600 mb-1">Measurements</p>
          <p className="text-lg font-bold text-green-900">
            {customer.measurements ? "âœ“ Saved" : "None"}
          </p>
        </div>
      </div>

      {/* Actions */}
      <div className="flex gap-2">
        <Button
          variant="ghost"
          onClick={() => onView(customer)}
          className="flex-1 text-primary-600 hover:bg-primary-50"
          icon={Eye}
        >
          View
        </Button>
        <Button
          variant="ghost"
          onClick={() => onEdit(customer)}
          className="text-blue-600 hover:bg-blue-50"
          icon={Edit}
        />
        <Button
          variant="ghost"
          onClick={() => onDelete(customer.id)}
          className="text-red-600 hover:bg-red-50"
          icon={Trash2}
        />
      </div>
    </motion.div>
  );
}


import { useState } from "react";
import { motion } from "framer-motion";
import { format } from "date-fns";
import {
  User,
  Phone,
  Mail,
  MapPin,
  ShoppingCart,
  Ruler,
  Edit,
  Plus,
  Calendar,
  DollarSign,
} from "lucide-react";
import Card from "../common/Card";
import Button from "../common/Button";
import Modal from "../common/Modal";
import MeasurementsForm from "./MeasurementsForm";
import OrderStatusBadge from "../orders/OrderStatusBadge";

export default function CustomerDetailsView({
  customer,
  onEdit,
  onUpdateMeasurements,
  stats,
}) {
  const [showMeasurementsModal, setShowMeasurementsModal] = useState(false);

  const handleSaveMeasurements = async (measurements) => {
    await onUpdateMeasurements(customer.id, measurements);
    setShowMeasurementsModal(false);
  };

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-start justify-between">
        <div className="flex items-center gap-4">
          <div className="w-20 h-20 bg-gradient-to-br from-primary-500 to-primary-600 rounded-full flex items-center justify-center text-white font-bold text-3xl">
            {customer.name
              .split(" ")
              .map((n) => n[0])
              .join("")
              .toUpperCase()
              .slice(0, 2)}
          </div>
          <div>
            <h2 className="text-3xl font-bold text-gray-900 mb-1">
              {customer.name}
            </h2>
            <p className="text-gray-600">
              Customer since{" "}
              {format(new Date(customer.created_at), "MMMM dd, yyyy")}
            </p>
          </div>
        </div>
        <Button
          variant="secondary"
          icon={Edit}
          onClick={() => onEdit(customer)}
        >
          Edit Customer
        </Button>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Left Column - Details */}
        <div className="lg:col-span-2 space-y-6">
          {/* Contact Information */}
          <Card>
            <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <User size={20} className="text-primary-600" />
              Contact Information
            </h3>
            <div className="space-y-3">
              <div className="flex items-center gap-3">
                <Phone size={18} className="text-gray-400" />
                <div>
                  <p className="text-xs text-gray-500">Phone</p>
                  <p className="font-semibold text-gray-900">
                    {customer.phone}
                  </p>
                </div>
              </div>
              {customer.email && (
                <div className="flex items-center gap-3">
                  <Mail size={18} className="text-gray-400" />
                  <div>
                    <p className="text-xs text-gray-500">Email</p>
                    <p className="font-semibold text-gray-900">
                      {customer.email}
                    </p>
                  </div>
                </div>
              )}
              {customer.address && (
                <div className="flex items-center gap-3">
                  <MapPin size={18} className="text-gray-400" />
                  <div>
                    <p className="text-xs text-gray-500">Address</p>
                    <p className="font-semibold text-gray-900">
                      {customer.address}
                    </p>
                  </div>
                </div>
              )}
              {customer.notes && (
                <div className="pt-3 border-t border-gray-100">
                  <p className="text-xs text-gray-500 mb-1">Notes</p>
                  <p className="text-gray-700">{customer.notes}</p>
                </div>
              )}
            </div>
          </Card>

          {/* Measurements */}
          <Card>
            <div className="flex items-center justify-between mb-4">
              <h3 className="text-lg font-semibold text-gray-900 flex items-center gap-2">
                <Ruler size={20} className="text-primary-600" />
                Body Measurements
              </h3>
              <Button
                variant="secondary"
                icon={customer.measurements ? Edit : Plus}
                onClick={() => setShowMeasurementsModal(true)}
              >
                {customer.measurements ? "Update" : "Add Measurements"}
              </Button>
            </div>

            {customer.measurements ? (
              <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                {Object.entries(customer.measurements)
                  .filter(([key]) => key !== "notes")
                  .map(([key, value]) => (
                    <div key={key} className="bg-gray-50 rounded-lg p-3">
                      <p className="text-xs text-gray-500 mb-1 capitalize">
                        {key.replace(/_/g, " ")}
                      </p>
                      <p className="font-semibold text-gray-900">{value}"</p>
                    </div>
                  ))}
                {customer.measurements.notes && (
                  <div className="col-span-2 md:col-span-3 bg-blue-50 rounded-lg p-3">
                    <p className="text-xs text-blue-600 mb-1">Notes</p>
                    <p className="text-sm text-blue-900">
                      {customer.measurements.notes}
                    </p>
                  </div>
                )}
              </div>
            ) : (
              <div className="text-center py-8 bg-gray-50 rounded-lg">
                <Ruler className="mx-auto text-gray-400 mb-2" size={32} />
                <p className="text-gray-600 mb-1">No measurements recorded</p>
                <p className="text-sm text-gray-500">
                  Add measurements to help with future orders
                </p>
              </div>
            )}
          </Card>

          {/* Order History */}
          <Card>
            <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <ShoppingCart size={20} className="text-primary-600" />
              Order History
            </h3>

            {customer.orders && customer.orders.length > 0 ? (
              <div className="space-y-3">
                {customer.orders.map((order, index) => (
                  <motion.div
                    key={order.id}
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: index * 0.05 }}
                    className="flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer"
                  >
                    <div className="flex-1">
                      <div className="flex items-center gap-3 mb-2">
                        <p className="font-semibold text-gray-900">
                          {order.order_number}
                        </p>
                        <OrderStatusBadge status={order.status} />
                      </div>
                      <p className="text-sm text-gray-600 line-clamp-1">
                        {order.description}
                      </p>
                      <div className="flex items-center gap-4 mt-2 text-xs text-gray-500">
                        <span className="flex items-center gap-1">
                          <Calendar size={12} />
                          {format(new Date(order.order_date), "MMM dd, yyyy")}
                        </span>
                        {order.due_date && (
                          <span>
                            Due: {format(new Date(order.due_date), "MMM dd")}
                          </span>
                        )}
                      </div>
                    </div>
                    <div className="text-right ml-4">
                      <p className="font-bold text-gray-900">
                        K{parseFloat(order.total_cost).toFixed(2)}
                      </p>
                      {order.balance > 0 && (
                        <p className="text-xs text-red-600">
                          Balance: K{parseFloat(order.balance).toFixed(2)}
                        </p>
                      )}
                    </div>
                  </motion.div>
                ))}
              </div>
            ) : (
              <div className="text-center py-8 bg-gray-50 rounded-lg">
                <ShoppingCart
                  className="mx-auto text-gray-400 mb-2"
                  size={32}
                />
                <p className="text-gray-600">No orders yet</p>
              </div>
            )}
          </Card>
        </div>

        {/* Right Column - Statistics */}
        <div className="space-y-6">
          {/* Customer Stats */}
          {stats && (
            <>
              <Card className="bg-gradient-to-br from-blue-50 to-white">
                <div className="text-center">
                  <ShoppingCart
                    className="mx-auto text-blue-600 mb-2"
                    size={32}
                  />
                  <p className="text-sm text-blue-600 mb-1">Total Orders</p>
                  <p className="text-4xl font-bold text-blue-900">
                    {stats.totalOrders}
                  </p>
                </div>
              </Card>

              <Card className="bg-gradient-to-br from-green-50 to-white">
                <div className="text-center">
                  <DollarSign
                    className="mx-auto text-green-600 mb-2"
                    size={32}
                  />
                  <p className="text-sm text-green-600 mb-1">Total Spent</p>
                  <p className="text-4xl font-bold text-green-900">
                    K{stats.totalSpent.toFixed(0)}
                  </p>
                </div>
              </Card>

              <Card>
                <h3 className="font-semibold text-gray-900 mb-4">
                  Quick Stats
                </h3>
                <div className="space-y-3">
                  <div className="flex items-center justify-between">
                    <span className="text-sm text-gray-600">
                      Completed Orders
                    </span>
                    <span className="font-semibold text-gray-900">
                      {stats.completedOrders}
                    </span>
                  </div>
                  <div className="flex items-center justify-between">
                    <span className="text-sm text-gray-600">Active Orders</span>
                    <span className="font-semibold text-gray-900">
                      {stats.activeOrders}
                    </span>
                  </div>
                  {stats.lastOrderDate && (
                    <div className="pt-3 border-t border-gray-100">
                      <p className="text-xs text-gray-500 mb-1">Last Order</p>
                      <p className="text-sm font-semibold text-gray-900">
                        {format(new Date(stats.lastOrderDate), "MMM dd, yyyy")}
                      </p>
                    </div>
                  )}
                </div>
              </Card>
            </>
          )}
        </div>
      </div>

      {/* Measurements Modal */}
      <Modal
        isOpen={showMeasurementsModal}
        onClose={() => setShowMeasurementsModal(false)}
        title={
          customer.measurements ? "Update Measurements" : "Add Measurements"
        }
        size="lg"
      >
        <MeasurementsForm
          customer={customer}
          onSubmit={handleSaveMeasurements}
          onCancel={() => setShowMeasurementsModal(false)}
        />
      </Modal>
    </div>
  );
}


import { useState, useEffect } from "react";
import { useForm } from "react-hook-form";
import Input from "../common/Input";
import Button from "../common/Button";
import { Ruler } from "lucide-react";

const MEASUREMENT_FIELDS = [
  { name: "bust", label: "Bust", unit: "inches" },
  { name: "waist", label: "Waist", unit: "inches" },
  { name: "hips", label: "Hips", unit: "inches" },
  { name: "shoulder_width", label: "Shoulder Width", unit: "inches" },
  { name: "sleeve_length", label: "Sleeve Length", unit: "inches" },
  { name: "arm_circumference", label: "Arm Circumference", unit: "inches" },
  { name: "dress_length", label: "Dress Length", unit: "inches" },
  { name: "skirt_length", label: "Skirt Length", unit: "inches" },
  { name: "inseam", label: "Inseam", unit: "inches" },
  { name: "outseam", label: "Outseam", unit: "inches" },
  { name: "thigh_circumference", label: "Thigh Circumference", unit: "inches" },
  { name: "neck_circumference", label: "Neck Circumference", unit: "inches" },
];

export default function MeasurementsForm({ customer, onSubmit, onCancel }) {
  const [loading, setLoading] = useState(false);

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
  } = useForm({
    defaultValues: customer?.measurements || {},
  });

  useEffect(() => {
    if (customer?.measurements) {
      reset(customer.measurements);
    }
  }, [customer, reset]);

  const handleFormSubmit = async (data) => {
    setLoading(true);
    try {
      // Remove empty values
      const measurements = Object.fromEntries(
        Object.entries(data).filter(
          ([_, value]) => value !== "" && value !== null
        )
      );
      await onSubmit(measurements);
    } catch (error) {
      console.error(error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit(handleFormSubmit)} className="space-y-6">
      <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
        <div className="flex items-start gap-3">
          <Ruler className="text-blue-600 flex-shrink-0 mt-1" size={20} />
          <div>
            <h3 className="font-semibold text-blue-900 mb-1">
              Measurement Guidelines
            </h3>
            <p className="text-sm text-blue-800">
              All measurements are in inches. Take measurements over
              undergarments for accuracy. Leave fields blank if not applicable.
            </p>
          </div>
        </div>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {MEASUREMENT_FIELDS.map((field) => (
          <div key={field.name}>
            <Input
              label={`${field.label} (${field.unit})`}
              type="number"
              step="0.1"
              placeholder="0.0"
              {...register(field.name, {
                min: { value: 0, message: "Must be positive" },
              })}
              error={errors[field.name]?.message}
            />
          </div>
        ))}
      </div>

      {/* Additional Notes */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          Additional Notes
        </label>
        <textarea
          rows={3}
          className="input-field resize-none"
          placeholder="Any special notes about measurements, body shape, preferences, etc."
          {...register("notes")}
        />
      </div>

      {/* Actions */}
      <div className="flex gap-3 justify-end pt-4 border-t border-gray-200">
        <Button
          type="button"
          variant="secondary"
          onClick={onCancel}
          disabled={loading}
        >
          Cancel
        </Button>
        <Button type="submit" loading={loading}>
          Save Measurements
        </Button>
      </div>
    </form>
  );
}


import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Legend,
} from "recharts";
import { motion } from "framer-motion";
import Card from "../common/Card";

export default function EmployeeProductivityChart({ data }) {
  if (!data || data.length === 0) {
    return (
      <Card>
        <h3 className="text-lg font-semibold text-gray-900 mb-4">
          Employee Productivity
        </h3>
        <div className="text-center py-8 text-gray-500">
          No productivity data available
        </div>
      </Card>
    );
  }

  return (
    <Card>
      <h3 className="text-lg font-semibold text-gray-900 mb-4">
        Employee Productivity
      </h3>
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
      >
        <ResponsiveContainer width="100%" height={300}>
          <BarChart data={data} layout="vertical">
            <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
            <XAxis type="number" stroke="#666" style={{ fontSize: "12px" }} />
            <YAxis
              dataKey="name"
              type="category"
              stroke="#666"
              style={{ fontSize: "12px" }}
              width={100}
            />
            <Tooltip
              contentStyle={{
                backgroundColor: "#fff",
                border: "1px solid #e5e7eb",
                borderRadius: "8px",
                boxShadow: "0 4px 6px rgba(0, 0, 0, 0.1)",
              }}
              formatter={(value, name) => {
                if (name === "hours") return [value.toFixed(1), "Hours Worked"];
                if (name === "orders") return [value, "Orders Completed"];
                return value;
              }}
            />
            <Legend />
            <Bar
              dataKey="hours"
              fill="#10b981"
              name="Hours Worked"
              radius={[0, 8, 8, 0]}
            />
            <Bar
              dataKey="orders"
              fill="#3b82f6"
              name="Orders Completed"
              radius={[0, 8, 8, 0]}
            />
          </BarChart>
        </ResponsiveContainer>
      </motion.div>
    </Card>
  );
}


import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Legend,
} from "recharts";
import { motion } from "framer-motion";
import Card from "../common/Card";

export default function MaterialUsageChart({ data }) {
  if (!data || data.length === 0) {
    return (
      <Card>
        <h3 className="text-lg font-semibold text-gray-900 mb-4">
          Top Materials Used
        </h3>
        <div className="text-center py-8 text-gray-500">
          No material usage data available
        </div>
      </Card>
    );
  }

  return (
    <Card>
      <h3 className="text-lg font-semibold text-gray-900 mb-4">
        Top Materials Used
      </h3>
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
      >
        <ResponsiveContainer width="100%" height={300}>
          <BarChart data={data}>
            <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
            <XAxis
              dataKey="name"
              stroke="#666"
              style={{ fontSize: "11px" }}
              angle={-45}
              textAnchor="end"
              height={80}
            />
            <YAxis stroke="#666" style={{ fontSize: "12px" }} />
            <Tooltip
              contentStyle={{
                backgroundColor: "#fff",
                border: "1px solid #e5e7eb",
                borderRadius: "8px",
                boxShadow: "0 4px 6px rgba(0, 0, 0, 0.1)",
              }}
              formatter={(value, name) => {
                const n = Number(value);
                const isNum = Number.isFinite(n);
                const lname = String(name || "").toLowerCase();
                if (isNum) {
                  if (lname.includes("quantity"))
                    return [n.toFixed(2), "Quantity Used"];
                  if (lname.includes("cost"))
                    return [`K${n.toFixed(2)}`, "Total Cost"];
                  return [n, name];
                }
                return [value, name];
              }}
            />
            <Legend />
            <Bar
              dataKey="quantity"
              fill="#ec4899"
              name="Quantity Used"
              radius={[8, 8, 0, 0]}
            />
            <Bar
              dataKey="cost"
              fill="#8b5cf6"
              name="Total Cost"
              radius={[8, 8, 0, 0]}
            />
          </BarChart>
        </ResponsiveContainer>
      </motion.div>
    </Card>
  );
}


import {
  PieChart,
  Pie,
  Cell,
  ResponsiveContainer,
  Legend,
  Tooltip,
} from "recharts";
import Card from "../common/Card";
import { ShoppingCart } from "lucide-react";

const STATUS_COLORS = {
  enquiry: "#9ca3af",
  contacted: "#3b82f6",
  measurements: "#a855f7",
  production: "#eab308",
  fitting: "#f97316",
  completed: "#22c55e",
  delivered: "#10b981",
  cancelled: "#ef4444",
};

const STATUS_LABELS = {
  enquiry: "Enquiry",
  contacted: "Contacted",
  measurements: "Measurements",
  production: "Production",
  fitting: "Fitting",
  completed: "Completed",
  delivered: "Delivered",
  cancelled: "Cancelled",
};

export default function OrderStatusChart({ ordersByStatus = {} }) {
  const data = Object.entries(ordersByStatus)
    .filter(([_, value]) => value > 0)
    .map(([status, value]) => ({
      name: STATUS_LABELS[status] || status,
      value,
      color: STATUS_COLORS[status] || "#9ca3af",
    }));

  if (data.length === 0) {
    return (
      <Card>
        <h2 className="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
          <ShoppingCart className="text-primary-600" size={24} />
          Order Distribution
        </h2>
        <div className="text-center py-12 text-gray-500">
          No orders to display
        </div>
      </Card>
    );
  }

  return (
    <Card>
      <h2 className="text-xl font-bold text-gray-900 mb-4 flex items-center gap-2">
        <ShoppingCart className="text-primary-600" size={24} />
        Order Distribution
      </h2>

      <ResponsiveContainer width="100%" height={300}>
        <PieChart>
          <Pie
            data={data}
            cx="50%"
            cy="50%"
            labelLine={false}
            label={({ name, percent }) =>
              `${name}: ${(percent * 100).toFixed(0)}%`
            }
            outerRadius={100}
            fill="#8884d8"
            dataKey="value"
          >
            {data.map((entry, index) => (
              <Cell key={`cell-${index}`} fill={entry.color} />
            ))}
          </Pie>
          <Tooltip formatter={(value) => [`${value} orders`, "Count"]} />
          <Legend />
        </PieChart>
      </ResponsiveContainer>
    </Card>
  );
}


import {
  LineChart,
  Line,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Legend,
} from "recharts";
import { motion } from "framer-motion";
import Card from "../common/Card";

export default function RevenueChart({ data }) {
  if (!data || data.length === 0) {
    return (
      <Card>
        <h3 className="text-lg font-semibold text-gray-900 mb-4">
          Revenue Trend
        </h3>
        <div className="text-center py-8 text-gray-500">
          No revenue data available
        </div>
      </Card>
    );
  }

  return (
    <Card>
      <h3 className="text-lg font-semibold text-gray-900 mb-4">
        Revenue Trend
      </h3>
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
      >
        <ResponsiveContainer width="100%" height={300}>
          <LineChart data={data}>
            <CartesianGrid strokeDasharray="3 3" stroke="#f0f0f0" />
            <XAxis dataKey="month" stroke="#666" style={{ fontSize: "12px" }} />
            <YAxis
              stroke="#666"
              style={{ fontSize: "12px" }}
              tickFormatter={(value) => `K${value ?? 0}`}
            />
            <Tooltip
              contentStyle={{
                backgroundColor: "#fff",
                border: "1px solid #e5e7eb",
                borderRadius: "8px",
                boxShadow: "0 4px 6px rgba(0, 0, 0, 0.1)",
              }}
              formatter={(value) => {
                const n = Number(value);
                const num = Number.isFinite(n) ? n : 0;
                return [`K${num.toFixed(2)}`, "Revenue"];
              }}
            />
            <Legend />
            <Line
              type="monotone"
              dataKey="revenue"
              stroke="#ec4899"
              strokeWidth={3}
              dot={{ fill: "#ec4899", r: 5 }}
              activeDot={{ r: 7 }}
              name="Revenue"
            />
          </LineChart>
        </ResponsiveContainer>
      </motion.div>
    </Card>
  );
}


import { motion } from "framer-motion";
import Card from "../common/Card";
import { TrendingUp, TrendingDown } from "lucide-react";

export default function StatsCard({
  title,
  value,
  subtitle,
  icon: Icon,
  color = "blue",
  trend,
  delay = 0,
}) {
  const colorClasses = {
    blue: "bg-blue-100 text-blue-600",
    green: "bg-green-100 text-green-600",
    yellow: "bg-yellow-100 text-yellow-600",
    purple: "bg-purple-100 text-purple-600",
    red: "bg-red-100 text-red-600",
    primary: "bg-primary-100 text-primary-600",
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ delay }}
    >
      <Card className="hover:shadow-lg transition-shadow duration-200">
        <div className="flex items-center justify-between">
          <div className="flex-1">
            <p className="text-sm text-gray-600 mb-1">{title}</p>
            <p className="text-3xl font-bold text-gray-900 mb-1">{value}</p>
            {subtitle && <p className="text-xs text-gray-500">{subtitle}</p>}
            {trend && (
              <div
                className={`flex items-center gap-1 mt-2 text-xs font-medium ${
                  parseFloat(trend) >= 0 ? "text-green-600" : "text-red-600"
                }`}
              >
                {parseFloat(trend) >= 0 ? (
                  <TrendingUp size={14} />
                ) : (
                  <TrendingDown size={14} />
                )}
                <span>{Math.abs(parseFloat(trend))}% vs last month</span>
              </div>
            )}
          </div>
          <div
            className={`w-14 h-14 rounded-xl flex items-center justify-center ${colorClasses[color]}`}
          >
            <Icon size={28} />
          </div>
        </div>
      </Card>
    </motion.div>
  );
}


import { useState, useEffect } from "react";
import { useForm } from "react-hook-form";
import Input from "../common/Input";
import Button from "../common/Button";
import { User, Mail, Phone, DollarSign, Briefcase } from "lucide-react";

const ROLES = ["tailor", "cutter", "designer", "manager", "assistant", "other"];

export default function AddEmployeeForm({ employee, onSubmit, onCancel }) {
  const [loading, setLoading] = useState(false);

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
  } = useForm({
    defaultValues: employee || {
      name: "",
      role: "tailor",
      email: "",
      phone: "",
      hire_date: new Date().toISOString().split("T")[0],
      hourly_rate: 0,
      active: true,
    },
  });

  useEffect(() => {
    if (employee) {
      reset(employee);
    }
  }, [employee, reset]);

  const handleFormSubmit = async (data) => {
    setLoading(true);
    try {
      await onSubmit(data);
      if (!employee) {
        reset();
      }
    } catch (error) {
      console.error(error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit(handleFormSubmit)} className="space-y-6">
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {/* Full Name */}
        <div className="md:col-span-2">
          <Input
            label="Full Name"
            placeholder="e.g., Jane Phiri"
            icon={User}
            error={errors.name?.message}
            {...register("name", { required: "Name is required" })}
          />
        </div>

        {/* Role */}
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Role
          </label>
          <div className="relative">
            <Briefcase
              className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
              size={20}
            />
            <select
              className="input-field pl-10"
              {...register("role", { required: "Role is required" })}
            >
              {ROLES.map((role) => (
                <option key={role} value={role}>
                  {role.charAt(0).toUpperCase() + role.slice(1)}
                </option>
              ))}
            </select>
          </div>
          {errors.role && (
            <p className="mt-1 text-sm text-red-600">{errors.role.message}</p>
          )}
        </div>

        {/* Hire Date */}
        <div>
          <Input
            label="Hire Date"
            type="date"
            error={errors.hire_date?.message}
            {...register("hire_date", { required: "Hire date is required" })}
          />
        </div>

        {/* Email */}
        <div>
          <Input
            label="Email (Optional)"
            type="email"
            placeholder="jane@example.com"
            icon={Mail}
            error={errors.email?.message}
            {...register("email", {
              pattern: {
                value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,
                message: "Invalid email address",
              },
            })}
          />
        </div>

        {/* Phone */}
        <div>
          <Input
            label="Phone Number"
            type="tel"
            placeholder="+260 XXX XXX XXX"
            icon={Phone}
            error={errors.phone?.message}
            {...register("phone", { required: "Phone number is required" })}
          />
        </div>

        {/* Hourly Rate */}
        <div>
          <Input
            label="Hourly Rate (K) - Optional"
            type="number"
            step="0.01"
            placeholder="0.00"
            icon={DollarSign}
            error={errors.hourly_rate?.message}
            {...register("hourly_rate", {
              min: { value: 0, message: "Must be 0 or greater" },
            })}
          />
        </div>

        {/* Active Status */}
        {employee && (
          <div className="md:col-span-2">
            <label className="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                className="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"
                {...register("active")}
              />
              <span className="text-sm font-medium text-gray-700">
                Employee is active
              </span>
            </label>
          </div>
        )}
      </div>

      {/* Actions */}
      <div className="flex gap-3 justify-end pt-4 border-t border-gray-200">
        <Button
          type="button"
          variant="secondary"
          onClick={onCancel}
          disabled={loading}
        >
          Cancel
        </Button>
        <Button type="submit" loading={loading}>
          {employee ? "Update Employee" : "Add Employee"}
        </Button>
      </div>
    </form>
  );
}


import { useState } from "react";
import { format } from "date-fns";
import { Calendar, Download, Filter } from "lucide-react";
import Card from "../common/Card";
import Button from "../common/Button";
import { employeeService } from "../../services/employeeService";
import toast from "react-hot-toast";

export default function AttendanceTable({ employee }) {
  const [attendance, setAttendance] = useState([]);
  const [loading, setLoading] = useState(false);
  const [dateRange, setDateRange] = useState({
    start: format(
      new Date(new Date().setDate(new Date().getDate() - 30)),
      "yyyy-MM-dd"
    ),
    end: format(new Date(), "yyyy-MM-dd"),
  });

  const fetchAttendance = async () => {
    setLoading(true);
    try {
      const data = await employeeService.getEmployeeAttendance(
        employee.id,
        dateRange.start,
        dateRange.end
      );
      setAttendance(data);
    } catch (error) {
      toast.error("Failed to fetch attendance records");
    } finally {
      setLoading(false);
    }
  };

  useState(() => {
    if (employee) {
      fetchAttendance();
    }
  }, [employee, dateRange]);

  const totalHours = attendance.reduce(
    (sum, record) => sum + parseFloat(record.hours_worked || 0),
    0
  );

  const totalEarnings = employee.hourly_rate
    ? totalHours * parseFloat(employee.hourly_rate)
    : 0;

  const exportToCSV = () => {
    const headers = ["Date", "Clock In", "Clock Out", "Hours Worked", "Notes"];
    const rows = attendance.map((record) => [
      format(new Date(record.date), "yyyy-MM-dd"),
      record.clock_in ? format(new Date(record.clock_in), "HH:mm:ss") : "N/A",
      record.clock_out ? format(new Date(record.clock_out), "HH:mm:ss") : "N/A",
      record.hours_worked || "0",
      record.notes || "",
    ]);

    const csvContent = [
      headers.join(","),
      ...rows.map((row) => row.map((cell) => `"${cell}"`).join(",")),
    ].join("\n");

    const blob = new Blob([csvContent], { type: "text/csv" });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `${employee.name.replace(/\s+/g, "_")}_attendance_${format(new Date(), "yyyy-MM-dd")}.csv`;
    a.click();
    window.URL.revokeObjectURL(url);
  };

  return (
    <Card>
      {/* Header */}
      <div className="flex items-center justify-between mb-6">
        <div>
          <h2 className="text-2xl font-bold text-gray-900">{employee.name}</h2>
          <p className="text-gray-600 capitalize">{employee.role}</p>
        </div>
        <Button
          variant="secondary"
          icon={Download}
          onClick={exportToCSV}
          disabled={attendance.length === 0}
        >
          Export CSV
        </Button>
      </div>

      {/* Date Range Filter */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 bg-gray-50 rounded-lg">
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Start Date
          </label>
          <input
            type="date"
            value={dateRange.start}
            onChange={(e) =>
              setDateRange((prev) => ({ ...prev, start: e.target.value }))
            }
            className="input-field"
          />
        </div>
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            End Date
          </label>
          <input
            type="date"
            value={dateRange.end}
            onChange={(e) =>
              setDateRange((prev) => ({ ...prev, end: e.target.value }))
            }
            className="input-field"
          />
        </div>
        <div className="flex items-end">
          <Button
            onClick={fetchAttendance}
            icon={Filter}
            loading={loading}
            className="w-full"
          >
            Apply Filter
          </Button>
        </div>
      </div>

      {/* Summary Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
        <div className="bg-blue-50 rounded-lg p-4">
          <p className="text-sm text-blue-600 mb-1">Total Days</p>
          <p className="text-2xl font-bold text-blue-900">
            {attendance.length}
          </p>
        </div>
        <div className="bg-green-50 rounded-lg p-4">
          <p className="text-sm text-green-600 mb-1">Total Hours</p>
          <p className="text-2xl font-bold text-green-900">
            {totalHours.toFixed(2)}
          </p>
        </div>
        {employee.hourly_rate && (
          <div className="bg-purple-50 rounded-lg p-4">
            <p className="text-sm text-purple-600 mb-1">Total Earnings</p>
            <p className="text-2xl font-bold text-purple-900">
              K{totalEarnings.toFixed(2)}
            </p>
          </div>
        )}
      </div>

      {/* Attendance Table */}
      {loading ? (
        <div className="text-center py-8">
          <div className="w-12 h-12 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto"></div>
          <p className="text-gray-600 mt-4">Loading attendance records...</p>
        </div>
      ) : attendance.length === 0 ? (
        <div className="text-center py-8">
          <Calendar className="mx-auto text-gray-400 mb-3" size={48} />
          <h3 className="text-lg font-semibold text-gray-900 mb-2">
            No Records Found
          </h3>
          <p className="text-gray-600">
            No attendance records for the selected date range.
          </p>
        </div>
      ) : (
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead>
              <tr className="border-b border-gray-200">
                <th className="text-left py-3 px-4 font-semibold text-gray-700">
                  Date
                </th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">
                  Clock In
                </th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">
                  Clock Out
                </th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">
                  Hours
                </th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">
                  Status
                </th>
                <th className="text-left py-3 px-4 font-semibold text-gray-700">
                  Notes
                </th>
              </tr>
            </thead>
            <tbody>
              {attendance.map((record) => (
                <tr
                  key={record.id}
                  className="border-b border-gray-100 hover:bg-gray-50"
                >
                  <td className="py-3 px-4">
                    <span className="font-medium text-gray-900">
                      {format(new Date(record.date), "MMM dd, yyyy")}
                    </span>
                    <br />
                    <span className="text-xs text-gray-500">
                      {format(new Date(record.date), "EEEE")}
                    </span>
                  </td>
                  <td className="py-3 px-4 text-gray-900">
                    {record.clock_in
                      ? format(new Date(record.clock_in), "hh:mm a")
                      : "-"}
                  </td>
                  <td className="py-3 px-4 text-gray-900">
                    {record.clock_out
                      ? format(new Date(record.clock_out), "hh:mm a")
                      : "-"}
                  </td>
                  <td className="py-3 px-4">
                    <span className="font-semibold text-primary-600">
                      {record.hours_worked
                        ? `${parseFloat(record.hours_worked).toFixed(2)}h`
                        : "-"}
                    </span>
                  </td>
                  <td className="py-3 px-4">
                    {record.clock_out ? (
                      <span className="px-2 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">
                        Completed
                      </span>
                    ) : record.clock_in ? (
                      <span className="px-2 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-medium">
                        In Progress
                      </span>
                    ) : (
                      <span className="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs font-medium">
                        Absent
                      </span>
                    )}
                  </td>
                  <td className="py-3 px-4 text-gray-600 text-sm">
                    {record.notes || "-"}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      )}
    </Card>
  );
}


import { useState, useEffect } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { Clock, LogIn, LogOut, User } from "lucide-react";
import { format } from "date-fns";
import Button from "../common/Button";
import Card from "../common/Card";
import { employeeService } from "../../services/employeeService";
import toast from "react-hot-toast";

export default function ClockInOut({ employees, onClockAction }) {
  const [selectedEmployee, setSelectedEmployee] = useState("");
  const [currentTime, setCurrentTime] = useState(new Date());
  const [loading, setLoading] = useState(false);
  const [todayStatus, setTodayStatus] = useState(null);
  const [notes, setNotes] = useState("");

  // Update current time every second
  useEffect(() => {
    const timer = setInterval(() => {
      setCurrentTime(new Date());
    }, 1000);

    return () => clearInterval(timer);
  }, []);

  // Fetch today's status when employee is selected
  useEffect(() => {
    if (selectedEmployee) {
      fetchTodayStatus();
    } else {
      setTodayStatus(null);
    }
  }, [selectedEmployee]);

  const fetchTodayStatus = async () => {
    try {
      const status = await employeeService.getTodayStatus(selectedEmployee);
      setTodayStatus(status);
    } catch (error) {
      setTodayStatus(null);
    }
  };

  const handleClockIn = async () => {
    if (!selectedEmployee) {
      toast.error("Please select an employee");
      return;
    }

    setLoading(true);
    try {
      await employeeService.clockIn(selectedEmployee, notes);
      toast.success("Clocked in successfully!");
      setNotes("");
      await fetchTodayStatus();
      onClockAction();
    } catch (error) {
      toast.error(error.message || "Failed to clock in");
    } finally {
      setLoading(false);
    }
  };

  const handleClockOut = async () => {
    if (!selectedEmployee) {
      toast.error("Please select an employee");
      return;
    }

    setLoading(true);
    try {
      await employeeService.clockOut(selectedEmployee, notes);
      toast.success("Clocked out successfully!");
      setNotes("");
      await fetchTodayStatus();
      onClockAction();
    } catch (error) {
      toast.error(error.message || "Failed to clock out");
    } finally {
      setLoading(false);
    }
  };

  const selectedEmployeeData = employees.find((e) => e.id === selectedEmployee);
  const isClockedIn =
    todayStatus && todayStatus.clock_in && !todayStatus.clock_out;
  const isCompleted = todayStatus && todayStatus.clock_out;

  return (
    <Card className="bg-gradient-to-br from-primary-50 to-white">
      <div className="text-center mb-6">
        <div className="inline-flex items-center justify-center w-16 h-16 bg-primary-100 rounded-full mb-3">
          <Clock className="text-primary-600" size={32} />
        </div>
        <h2 className="text-2xl font-bold text-gray-900 mb-2">Time Clock</h2>
        <div className="text-4xl font-bold text-primary-600">
          {format(currentTime, "HH:mm:ss")}
        </div>
        <p className="text-gray-600 mt-1">
          {format(currentTime, "EEEE, MMMM dd, yyyy")}
        </p>
      </div>

      <div className="space-y-4">
        {/* Employee Selection */}
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Select Employee
          </label>
          <div className="relative">
            <User
              className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
              size={20}
            />
            <select
              value={selectedEmployee}
              onChange={(e) => setSelectedEmployee(e.target.value)}
              className="input-field pl-10"
              disabled={loading}
            >
              <option value="">Choose an employee...</option>
              {employees
                .filter((e) => e.active)
                .map((employee) => (
                  <option key={employee.id} value={employee.id}>
                    {employee.name} - {employee.role}
                  </option>
                ))}
            </select>
          </div>
        </div>

        {/* Status Display */}
        <AnimatePresence mode="wait">
          {selectedEmployee && todayStatus && (
            <motion.div
              initial={{ opacity: 0, height: 0 }}
              animate={{ opacity: 1, height: "auto" }}
              exit={{ opacity: 0, height: 0 }}
              className="bg-white rounded-lg p-4 border border-gray-200"
            >
              <h3 className="font-semibold text-gray-900 mb-3">
                Today's Status
              </h3>

              {todayStatus.clock_in && (
                <div className="flex items-center justify-between mb-2">
                  <span className="text-sm text-gray-600">Clock In:</span>
                  <span className="font-semibold text-green-600">
                    {format(new Date(todayStatus.clock_in), "hh:mm a")}
                  </span>
                </div>
              )}

              {todayStatus.clock_out && (
                <>
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm text-gray-600">Clock Out:</span>
                    <span className="font-semibold text-red-600">
                      {format(new Date(todayStatus.clock_out), "hh:mm a")}
                    </span>
                  </div>
                  <div className="flex items-center justify-between pt-2 border-t border-gray-100">
                    <span className="text-sm text-gray-600">Hours Worked:</span>
                    <span className="font-bold text-primary-600 text-lg">
                      {parseFloat(todayStatus.hours_worked).toFixed(2)} hrs
                    </span>
                  </div>
                </>
              )}

              {isClockedIn && (
                <div className="mt-3 bg-green-50 border border-green-200 rounded-lg p-3 text-center">
                  <p className="text-sm font-medium text-green-800">
                    ðŸŸ¢ Currently Clocked In
                  </p>
                </div>
              )}

              {isCompleted && (
                <div className="mt-3 bg-blue-50 border border-blue-200 rounded-lg p-3 text-center">
                  <p className="text-sm font-medium text-blue-800">
                    âœ… Shift Completed
                  </p>
                </div>
              )}
            </motion.div>
          )}
        </AnimatePresence>

        {/* Notes */}
        {selectedEmployee && !isCompleted && (
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Notes (Optional)
            </label>
            <textarea
              rows={2}
              className="input-field resize-none"
              placeholder="Add any notes..."
              value={notes}
              onChange={(e) => setNotes(e.target.value)}
              disabled={loading}
            />
          </div>
        )}

        {/* Action Buttons */}
        {selectedEmployee && !isCompleted && (
          <div className="grid grid-cols-2 gap-3">
            <Button
              onClick={handleClockIn}
              disabled={loading || isClockedIn}
              className={`${isClockedIn ? "opacity-50" : "bg-green-600 hover:bg-green-700"}`}
              icon={LogIn}
              loading={loading && !isClockedIn}
            >
              Clock In
            </Button>
            <Button
              onClick={handleClockOut}
              disabled={loading || !isClockedIn}
              className={`${!isClockedIn ? "opacity-50" : "bg-red-600 hover:bg-red-700"}`}
              icon={LogOut}
              loading={loading && isClockedIn}
            >
              Clock Out
            </Button>
          </div>
        )}

        {!selectedEmployee && (
          <div className="text-center py-4 text-gray-500 text-sm">
            Select an employee to clock in/out
          </div>
        )}
      </div>
    </Card>
  );
}


import { motion } from "framer-motion";
import { User, Mail, Phone, Calendar, Edit, UserX, Clock } from "lucide-react";
import Button from "../common/Button";
import { format } from "date-fns";

export default function EmployeeCard({
  employee,
  onEdit,
  onDeactivate,
  onViewDetails,
}) {
  const getRoleBadgeColor = (role) => {
    const colors = {
      tailor: "bg-purple-100 text-purple-700",
      cutter: "bg-blue-100 text-blue-700",
      designer: "bg-pink-100 text-pink-700",
      manager: "bg-green-100 text-green-700",
      assistant: "bg-yellow-100 text-yellow-700",
    };
    return colors[role.toLowerCase()] || "bg-gray-100 text-gray-700";
  };

  return (
    <motion.div
      initial={{ opacity: 0, scale: 0.95 }}
      animate={{ opacity: 1, scale: 1 }}
      whileHover={{ y: -4 }}
      className={`bg-white rounded-xl shadow-sm border border-gray-200 p-5 hover:shadow-md transition-all duration-200 ${
        !employee.active ? "opacity-60" : ""
      }`}
    >
      {/* Header with Avatar */}
      <div className="flex items-start justify-between mb-4">
        <div className="flex items-center gap-3">
          <div className="w-14 h-14 bg-gradient-to-br from-primary-500 to-primary-600 rounded-full flex items-center justify-center text-white font-bold text-xl">
            {employee.name
              .split(" ")
              .map((n) => n[0])
              .join("")
              .toUpperCase()
              .slice(0, 2)}
          </div>
          <div>
            <h3 className="font-semibold text-gray-900 text-lg">
              {employee.name}
            </h3>
            <span
              className={`text-xs font-medium px-2 py-1 rounded-full ${getRoleBadgeColor(employee.role)}`}
            >
              {employee.role.charAt(0).toUpperCase() + employee.role.slice(1)}
            </span>
          </div>
        </div>

        {!employee.active && (
          <div className="bg-red-100 text-red-700 px-2 py-1 rounded-full text-xs font-medium">
            Inactive
          </div>
        )}
      </div>

      {/* Contact Info */}
      <div className="space-y-2 mb-4 pb-4 border-b border-gray-100">
        {employee.email && (
          <div className="flex items-center gap-2 text-sm text-gray-600">
            <Mail size={16} className="text-gray-400" />
            <span className="truncate">{employee.email}</span>
          </div>
        )}
        <div className="flex items-center gap-2 text-sm text-gray-600">
          <Phone size={16} className="text-gray-400" />
          <span>{employee.phone}</span>
        </div>
        <div className="flex items-center gap-2 text-sm text-gray-600">
          <Calendar size={16} className="text-gray-400" />
          <span>
            Hired: {format(new Date(employee.hire_date), "MMM dd, yyyy")}
          </span>
        </div>
      </div>

      {/* Hourly Rate */}
      {employee.hourly_rate && (
        <div className="mb-4">
          <p className="text-xs text-gray-500 mb-1">Hourly Rate</p>
          <p className="text-lg font-bold text-gray-900">
            K{parseFloat(employee.hourly_rate).toFixed(2)}/hr
          </p>
        </div>
      )}

      {/* Actions */}
      <div className="flex gap-2">
        <Button
          variant="ghost"
          onClick={() => onViewDetails(employee)}
          className="flex-1 text-primary-600 hover:bg-primary-50"
          icon={Clock}
        >
          Attendance
        </Button>
        <Button
          variant="ghost"
          onClick={() => onEdit(employee)}
          className="text-blue-600 hover:bg-blue-50"
          icon={Edit}
        />
        {employee.active && (
          <Button
            variant="ghost"
            onClick={() => onDeactivate(employee.id)}
            className="text-red-600 hover:bg-red-50"
            icon={UserX}
          />
        )}
      </div>
    </motion.div>
  );
}

import { motion } from "framer-motion";
import { Clock, CheckCircle, XCircle } from "lucide-react";
import { format } from "date-fns";
import Card from "../common/Card";

export default function TodayAttendance({ attendance }) {
  if (!attendance || attendance.length === 0) {
    return (
      <Card>
        <div className="text-center py-8">
          <Clock className="mx-auto text-gray-400 mb-3" size={48} />
          <h3 className="text-lg font-semibold text-gray-900 mb-2">
            No Attendance Today
          </h3>
          <p className="text-gray-600">No employees have clocked in yet.</p>
        </div>
      </Card>
    );
  }

  return (
    <Card>
      <h2 className="text-xl font-bold text-gray-900 mb-4">
        Today's Attendance
      </h2>
      <div className="space-y-3">
        {attendance.map((record, index) => {
          const employee = record.employees;
          const isClockedOut = !!record.clock_out;
          return (
            <motion.div
              key={record.id}
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: index * 0.05 }}
              className={`flex items-center justify-between p-4 rounded-lg border ${
                isClockedOut
                  ? "bg-gray-50 border-gray-200"
                  : "bg-green-50 border-green-200"
              }`}
            >
              <div className="flex items-center gap-3">
                <div
                  className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-medium ${
                    isClockedOut ? "bg-gray-400" : "bg-green-500"
                  }`}
                >
                  {employee.name
                    .split(" ")
                    .map((n) => n[0])
                    .join("")
                    .toUpperCase()
                    .slice(0, 2)}
                </div>
                <div>
                  <h3 className="font-semibold text-gray-900">
                    {employee.name}
                  </h3>
                  <p className="text-sm text-gray-600 capitalize">
                    {employee.role}
                  </p>
                </div>
              </div>

              <div className="flex items-center gap-6">
                {/* Clock In Time */}
                <div className="text-right">
                  <p className="text-xs text-gray-500 mb-1">Clock In</p>
                  <p className="font-semibold text-gray-900">
                    {format(new Date(record.clock_in), "hh:mm a")}
                  </p>
                </div>

                {/* Clock Out Time or Status */}
                {isClockedOut ? (
                  <>
                    <div className="text-right">
                      <p className="text-xs text-gray-500 mb-1">Clock Out</p>
                      <p className="font-semibold text-gray-900">
                        {format(new Date(record.clock_out), "hh:mm a")}
                      </p>
                    </div>
                    <div className="text-right">
                      <p className="text-xs text-gray-500 mb-1">Hours</p>
                      <p className="font-bold text-primary-600">
                        {parseFloat(record.hours_worked).toFixed(2)}h
                      </p>
                    </div>
                    <CheckCircle className="text-green-600" size={24} />
                  </>
                ) : (
                  <>
                    <div className="px-3 py-1 bg-green-600 text-white rounded-full text-sm font-medium">
                      Active
                    </div>
                    <div className="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                  </>
                )}
              </div>
            </motion.div>
          );
        })}
      </div>
    </Card>
  );
}


import { useState, useEffect } from "react";
import { useForm } from "react-hook-form";
import Input from "../common/Input";
import Button from "../common/Button";
import { Package, DollarSign, Layers, User } from "lucide-react";

const CATEGORIES = [
  "fabric",
  "thread",
  "buttons",
  "zippers",
  "lace",
  "elastic",
  "interfacing",
  "trim",
  "accessories",
  "other",
];

const UNITS = ["meters", "yards", "pieces", "rolls", "spools", "kg", "grams"];

export default function AddMaterialForm({ material, onSubmit, onCancel }) {
  const [loading, setLoading] = useState(false);

  const {
    register,
    handleSubmit,
    formState: { errors },
    reset,
  } = useForm({
    defaultValues: material || {
      name: "",
      category: "fabric",
      unit: "meters",
      stock_quantity: 0,
      min_stock_level: 0,
      cost_per_unit: 0,
      supplier: "",
      description: "",
    },
  });

  useEffect(() => {
    if (material) {
      reset(material);
    }
  }, [material, reset]);

  const handleFormSubmit = async (data) => {
    setLoading(true);
    try {
      await onSubmit(data);
      if (!material) {
        reset();
      }
    } catch (error) {
      console.error(error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit(handleFormSubmit)} className="space-y-6">
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {/* Material Name */}
        <div className="md:col-span-2">
          <Input
            label="Material Name"
            placeholder="e.g., Silk Fabric - Red"
            icon={Package}
            error={errors.name?.message}
            {...register("name", { required: "Material name is required" })}
          />
        </div>

        {/* Category */}
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Category
          </label>
          <select
            className="input-field"
            {...register("category", { required: "Category is required" })}
          >
            {CATEGORIES.map((cat) => (
              <option key={cat} value={cat}>
                {cat.charAt(0).toUpperCase() + cat.slice(1)}
              </option>
            ))}
          </select>
          {errors.category && (
            <p className="mt-1 text-sm text-red-600">
              {errors.category.message}
            </p>
          )}
        </div>

        {/* Unit */}
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Unit of Measurement
          </label>
          <select
            className="input-field"
            {...register("unit", { required: "Unit is required" })}
          >
            {UNITS.map((unit) => (
              <option key={unit} value={unit}>
                {unit.charAt(0).toUpperCase() + unit.slice(1)}
              </option>
            ))}
          </select>
          {errors.unit && (
            <p className="mt-1 text-sm text-red-600">{errors.unit.message}</p>
          )}
        </div>

        {/* Stock Quantity */}
        <div>
          <Input
            label="Current Stock Quantity"
            type="number"
            step="0.01"
            placeholder="0.00"
            icon={Layers}
            error={errors.stock_quantity?.message}
            {...register("stock_quantity", {
              required: "Stock quantity is required",
              min: { value: 0, message: "Must be 0 or greater" },
            })}
          />
        </div>

        {/* Minimum Stock Level */}
        <div>
          <Input
            label="Minimum Stock Level"
            type="number"
            step="0.01"
            placeholder="0.00"
            icon={Layers}
            error={errors.min_stock_level?.message}
            {...register("min_stock_level", {
              required: "Minimum stock level is required",
              min: { value: 0, message: "Must be 0 or greater" },
            })}
          />
        </div>

        {/* Cost per Unit */}
        <div>
          <Input
            label="Cost per Unit (K)"
            type="number"
            step="0.01"
            placeholder="0.00"
            icon={DollarSign}
            error={errors.cost_per_unit?.message}
            {...register("cost_per_unit", {
              required: "Cost per unit is required",
              min: { value: 0, message: "Must be 0 or greater" },
            })}
          />
        </div>

        {/* Supplier */}
        <div>
          <Input
            label="Supplier (Optional)"
            placeholder="e.g., ABC Textiles"
            icon={User}
            {...register("supplier")}
          />
        </div>

        {/* Description */}
        <div className="md:col-span-2">
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Description (Optional)
          </label>
          <textarea
            rows={3}
            className="input-field resize-none"
            placeholder="Add any additional notes about this material..."
            {...register("description")}
          />
        </div>
      </div>

      {/* Actions */}
      <div className="flex gap-3 justify-end pt-4 border-t border-gray-200">
        <Button
          type="button"
          variant="secondary"
          onClick={onCancel}
          disabled={loading}
        >
          Cancel
        </Button>
        <Button type="submit" loading={loading}>
          {material ? "Update Material" : "Add Material"}
        </Button>
      </div>
    </form>
  );
}


import { motion } from "framer-motion";
import { AlertTriangle, Package } from "lucide-react";
import Card from "../common/Card";

export default function LowStockAlert({ materials, onViewMaterial }) {
  if (!materials || materials.length === 0) return null;

  return (
    <Card className="border-l-4 border-l-red-500 bg-red-50">
      <div className="flex items-start gap-4">
        <div className="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center flex-shrink-0">
          <AlertTriangle className="text-red-600" size={24} />
        </div>

        <div className="flex-1">
          <h3 className="font-semibold text-red-900 mb-2">
            Low Stock Alert ({materials.length}{" "}
            {materials.length === 1 ? "item" : "items"})
          </h3>
          <p className="text-sm text-red-700 mb-4">
            The following materials are running low and need restocking:
          </p>

          <div className="space-y-2">
            {materials.slice(0, 5).map((material, index) => (
              <motion.div
                key={material.id}
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: index * 0.1 }}
                className="bg-white rounded-lg p-3 flex items-center justify-between cursor-pointer hover:shadow-sm transition-shadow"
                onClick={() => onViewMaterial(material)}
              >
                <div className="flex items-center gap-3">
                  <Package size={16} className="text-red-600" />
                  <div>
                    <p className="font-medium text-gray-900 text-sm">
                      {material.name}
                    </p>
                    <p className="text-xs text-gray-500">
                      Stock: {parseFloat(material.stock_quantity).toFixed(2)}{" "}
                      {material.unit}
                      (Min: {parseFloat(material.min_stock_level).toFixed(2)})
                    </p>
                  </div>
                </div>
                <span className="text-xs font-medium text-red-600">
                  {(
                    (parseFloat(material.stock_quantity) /
                      parseFloat(material.min_stock_level)) *
                    100
                  ).toFixed(0)}
                  %
                </span>
              </motion.div>
            ))}
          </div>

          {materials.length > 5 && (
            <p className="text-sm text-red-700 mt-3">
              + {materials.length - 5} more materials need attention
            </p>
          )}
        </div>
      </div>
    </Card>
  );
}


import { motion } from "framer-motion";
import { Package, AlertCircle, Edit, Trash2, Plus, Minus } from "lucide-react";
import Button from "../common/Button";

export default function MaterialCard({
  material,
  onEdit,
  onDelete,
  onUpdateStock,
}) {
  const isLowStock =
    parseFloat(material.stock_quantity) <= parseFloat(material.min_stock_level);
  const stockPercentage =
    (parseFloat(material.stock_quantity) /
      parseFloat(material.min_stock_level)) *
    100;

  return (
    <motion.div
      initial={{ opacity: 0, scale: 0.95 }}
      animate={{ opacity: 1, scale: 1 }}
      whileHover={{ y: -4 }}
      className="bg-white rounded-xl shadow-sm border border-gray-200 p-5 hover:shadow-md transition-shadow duration-200"
    >
      {/* Header */}
      <div className="flex items-start justify-between mb-4">
        <div className="flex items-start gap-3">
          <div
            className={`w-12 h-12 rounded-lg flex items-center justify-center ${
              isLowStock ? "bg-red-100" : "bg-primary-100"
            }`}
          >
            <Package
              className={isLowStock ? "text-red-600" : "text-primary-600"}
              size={24}
            />
          </div>
          <div>
            <h3 className="font-semibold text-gray-900 text-lg">
              {material.name}
            </h3>
            <span className="text-sm text-gray-500 capitalize">
              {material.category}
            </span>
          </div>
        </div>

        {isLowStock && (
          <div className="bg-red-100 text-red-700 px-2 py-1 rounded-full flex items-center gap-1 text-xs font-medium">
            <AlertCircle size={14} />
            Low Stock
          </div>
        )}
      </div>

      {/* Stock Info */}
      <div className="mb-4">
        <div className="flex items-baseline justify-between mb-2">
          <span className="text-2xl font-bold text-gray-900">
            {parseFloat(material.stock_quantity).toFixed(2)}
          </span>
          <span className="text-sm text-gray-500">{material.unit}</span>
        </div>

        {/* Stock Progress Bar */}
        <div className="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
          <motion.div
            initial={{ width: 0 }}
            animate={{ width: `${Math.min(stockPercentage, 100)}%` }}
            transition={{ duration: 0.5, ease: "easeOut" }}
            className={`h-full ${isLowStock ? "bg-red-500" : "bg-green-500"}`}
          />
        </div>

        <p className="text-xs text-gray-500 mt-1">
          Min: {parseFloat(material.min_stock_level).toFixed(2)} {material.unit}
        </p>
      </div>

      {/* Cost & Supplier */}
      <div className="grid grid-cols-2 gap-3 mb-4 pb-4 border-b border-gray-100">
        <div>
          <p className="text-xs text-gray-500 mb-1">Cost per unit</p>
          <p className="font-semibold text-gray-900">
            K{parseFloat(material.cost_per_unit).toFixed(2)}
          </p>
        </div>
        <div>
          <p className="text-xs text-gray-500 mb-1">Total Value</p>
          <p className="font-semibold text-gray-900">
            K
            {(
              parseFloat(material.stock_quantity) *
              parseFloat(material.cost_per_unit)
            ).toFixed(2)}
          </p>
        </div>
      </div>

      {material.supplier && (
        <p className="text-sm text-gray-600 mb-4">
          <span className="text-gray-500">Supplier:</span> {material.supplier}
        </p>
      )}

      {/* Actions */}
      <div className="flex gap-2">
        <Button
          variant="ghost"
          onClick={() => onUpdateStock(material, "add")}
          className="flex-1 text-green-600 hover:bg-green-50"
          icon={Plus}
        >
          Add
        </Button>
        <Button
          variant="ghost"
          onClick={() => onUpdateStock(material, "subtract")}
          className="flex-1 text-orange-600 hover:bg-orange-50"
          icon={Minus}
        >
          Use
        </Button>
        <Button
          variant="ghost"
          onClick={() => onEdit(material)}
          className="text-blue-600 hover:bg-blue-50"
          icon={Edit}
        />
        <Button
          variant="ghost"
          onClick={() => onDelete(material.id)}
          className="text-red-600 hover:bg-red-50"
          icon={Trash2}
        />
      </div>
    </motion.div>
  );
}


import { useState } from "react";
import Modal from "../common/Modal";
import Input from "../common/Input";
import Button from "../common/Button";
import { Package } from "lucide-react";

export default function StockUpdateModal({
  isOpen,
  onClose,
  material,
  operation,
  onUpdate,
}) {
  const [quantity, setQuantity] = useState("");
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!quantity || parseFloat(quantity) <= 0) return;

    setLoading(true);
    try {
      await onUpdate(material.id, parseFloat(quantity), operation);
      setQuantity("");
      onClose();
    } catch (error) {
      console.error(error);
    } finally {
      setLoading(false);
    }
  };

  const newQuantity =
    operation === "add"
      ? parseFloat(material?.stock_quantity || 0) + parseFloat(quantity || 0)
      : parseFloat(material?.stock_quantity || 0) - parseFloat(quantity || 0);

  return (
    <Modal
      isOpen={isOpen}
      onClose={onClose}
      title={operation === "add" ? "Add Stock" : "Deduct Stock"}
      size="sm"
    >
      <form onSubmit={handleSubmit} className="space-y-6">
        {/* Material Info */}
        <div className="bg-gray-50 rounded-lg p-4">
          <div className="flex items-center gap-3 mb-3">
            <div className="w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center">
              <Package className="text-primary-600" size={20} />
            </div>
            <div>
              <h3 className="font-semibold text-gray-900">{material?.name}</h3>
              <p className="text-sm text-gray-500">
                Current: {material?.stock_quantity} {material?.unit}
              </p>
            </div>
          </div>
        </div>

        {/* Quantity Input */}
        <Input
          label={`Quantity to ${operation === "add" ? "Add" : "Deduct"} (${material?.unit})`}
          type="number"
          step="0.01"
          placeholder="0.00"
          value={quantity}
          onChange={(e) => setQuantity(e.target.value)}
          required
        />

        {/* Preview */}
        {quantity && parseFloat(quantity) > 0 && (
          <div className="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <p className="text-sm text-blue-800">
              <span className="font-medium">New stock level:</span>{" "}
              <span className="text-lg font-bold">
                {newQuantity.toFixed(2)} {material?.unit}
              </span>
            </p>
          </div>
        )}

        {/* Warning for deduction */}
        {operation === "subtract" && quantity && newQuantity < 0 && (
          <div className="bg-red-50 border border-red-200 rounded-lg p-4">
            <p className="text-sm text-red-800 font-medium">
              âš ï¸ Warning: Stock will go negative!
            </p>
          </div>
        )}

        {/* Actions */}
        <div className="flex gap-3 justify-end">
          <Button
            type="button"
            variant="secondary"
            onClick={onClose}
            disabled={loading}
          >
            Cancel
          </Button>
          <Button
            type="submit"
            loading={loading}
            disabled={!quantity || parseFloat(quantity) <= 0}
          >
            {operation === "add" ? "Add Stock" : "Deduct Stock"}
          </Button>
        </div>
      </form>
    </Modal>
  );
}


import { Outlet } from "react-router-dom";
import Sidebar from "./Sidebar";
import Navbar from "./Navbar";

export default function Layout() {
  return (
    <div className="flex h-screen bg-gray-50">
      <Sidebar />
      <div className="flex-1 flex flex-col overflow-hidden">
        <Navbar />
        <main className="flex-1 overflow-y-auto p-6">
          <Outlet />
        </main>
      </div>
    </div>
  );
}


import { Bell, Search } from "lucide-react";

export default function Navbar() {
  return (
    <header className="bg-white border-b border-gray-200 px-6 py-4">
      <div className="flex items-center justify-between">
        <div className="flex-1 max-w-lg">
          <div className="relative">
            <Search
              className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
              size={20}
            />
            <input
              type="search"
              placeholder="Search orders, materials, customers..."
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
            />
          </div>
        </div>

        <div className="flex items-center gap-4">
          <button className="relative p-2 hover:bg-gray-100 rounded-lg transition-colors">
            <Bell size={20} className="text-gray-600" />
            <span className="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
          </button>

          <div className="flex items-center gap-3">
            <div className="w-10 h-10 bg-primary-600 rounded-full flex items-center justify-center text-white font-medium">
              GD
            </div>
          </div>
        </div>
      </div>
    </header>
  );
}


import { NavLink } from "react-router-dom";
import {
  LayoutDashboard,
  Package,
  ShoppingCart,
  Users,
  UserCircle,
  Scissors,
} from "lucide-react";
import { motion } from "framer-motion";

const navItems = [
  { path: "/dashboard", icon: LayoutDashboard, label: "Dashboard" },
  { path: "/inventory", icon: Package, label: "Inventory" },
  { path: "/orders", icon: ShoppingCart, label: "Orders" },
  { path: "/employees", icon: Users, label: "Employees" },
  { path: "/customers", icon: UserCircle, label: "Customers" },
];

export default function Sidebar() {
  return (
    <motion.aside
      initial={{ x: -300 }}
      animate={{ x: 0 }}
      className="w-64 bg-white border-r border-gray-200 flex flex-col"
    >
      <div className="p-6 border-b border-gray-200">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-primary-600 rounded-full flex items-center justify-center">
            <Scissors className="text-white" size={24} />
          </div>
          <div>
            <h1 className="font-bold text-3xl text-primary-600">GD</h1>
          </div>
        </div>
      </div>

      <nav className="flex-1 p-4">
        <ul className="space-y-2">
          {navItems.map((item) => (
            <li key={item.path}>
              <NavLink
                to={item.path}
                className={({ isActive }) =>
                  `flex items-center gap-3 px-4 py-3 rounded-lg transition-colors duration-200 ${
                    isActive
                      ? "bg-primary-50 text-primary-700 font-medium"
                      : "text-gray-700 hover:bg-gray-100"
                  }`
                }
              >
                <item.icon size={20} />
                <span>{item.label}</span>
              </NavLink>
            </li>
          ))}
        </ul>
      </nav>

      <div className="p-4 border-t border-gray-200">
        <p className="text-xs text-gray-500 text-center">
          v1.0.0 - Gloraz Daughter
        </p>
      </div>
    </motion.aside>
  );
}


import { useState, useEffect } from "react";
import { useForm } from "react-hook-form";
import { User, Calendar, DollarSign, FileText, Scissors } from "lucide-react";
import Input from "../common/Input";
import Button from "../common/Button";
import MaterialSelector from "./MaterialSelector";
import { supabase } from "../../lib/supabase";
import toast from "react-hot-toast";

export default function CreateOrderForm({ order, onSubmit, onCancel }) {
  const [loading, setLoading] = useState(false);
  const [customers, setCustomers] = useState([]);
  const [employees, setEmployees] = useState([]);
  const [selectedMaterials, setSelectedMaterials] = useState([]);
  const [showNewCustomer, setShowNewCustomer] = useState(false);

  const {
    register,
    handleSubmit,
    formState: { errors },
    watch,
    setValue,
    reset,
  } = useForm({
    defaultValues: order || {
      customer_id: "",
      due_date: "",
      total_cost: 0,
      deposit: 0,
      description: "",
      notes: "",
      assigned_tailor_id: "",
    },
  });

  useEffect(() => {
    fetchCustomers();
    fetchEmployees();
  }, []);

  useEffect(() => {
    if (order) {
      reset(order);
    }
  }, [order, reset]);

  const fetchCustomers = async () => {
    const { data, error } = await supabase
      .from("customers")
      .select("id, name, phone, email")
      .order("name");

    if (!error) {
      setCustomers(data || []);
    }
  };

  const fetchEmployees = async () => {
    const { data, error } = await supabase
      .from("employees")
      .select("id, name, role")
      .eq("active", true)
      .eq("role", "tailor")
      .order("name");

    if (!error) {
      setEmployees(data || []);
    }
  };

  // Watch for material cost changes
  useEffect(() => {
    const materialCost = selectedMaterials.reduce(
      (sum, m) => sum + parseFloat(m.cost || 0),
      0
    );
    const currentTotal = parseFloat(watch("total_cost") || 0);

    // Only auto-update if it's a new order
    if (!order && materialCost > 0) {
      setValue("total_cost", materialCost.toFixed(2));
    }
  }, [selectedMaterials, order, watch, setValue]);

  // Calculate balance
  const totalCost = watch("total_cost") || 0;
  const deposit = watch("deposit") || 0;
  const balance = parseFloat(totalCost) - parseFloat(deposit);

  const handleFormSubmit = async (data) => {
    if (selectedMaterials.length === 0) {
      toast.error("Please add at least one material");
      return;
    }

    setLoading(true);
    try {
      const orderData = {
        ...data,
        materials: selectedMaterials,
      };
      await onSubmit(orderData);
      if (!order) {
        reset();
        setSelectedMaterials([]);
      }
    } catch (error) {
      console.error(error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit(handleFormSubmit)} className="space-y-6">
      {/* Customer Selection */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          Customer
        </label>
        <div className="flex gap-2">
          <div className="relative flex-1">
            <User
              className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
              size={20}
            />
            <select
              className="input-field pl-10"
              {...register("customer_id", { required: "Customer is required" })}
            >
              <option value="">Select customer...</option>
              {customers.map((customer) => (
                <option key={customer.id} value={customer.id}>
                  {customer.name} - {customer.phone}
                </option>
              ))}
            </select>
          </div>
          <Button
            type="button"
            variant="secondary"
            onClick={() => setShowNewCustomer(true)}
          >
            New
          </Button>
        </div>
        {errors.customer_id && (
          <p className="mt-1 text-sm text-red-600">
            {errors.customer_id.message}
          </p>
        )}
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {/* Due Date */}
        <div>
          <Input
            label="Due Date"
            type="date"
            icon={Calendar}
            error={errors.due_date?.message}
            {...register("due_date", { required: "Due date is required" })}
          />
        </div>

        {/* Assigned Tailor */}
        <div>
          <label className="block text-sm font-medium text-gray-700 mb-2">
            Assign to Tailor (Optional)
          </label>
          <div className="relative">
            <Scissors
              className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
              size={20}
            />
            <select
              className="input-field pl-10"
              {...register("assigned_tailor_id")}
            >
              <option value="">Unassigned</option>
              {employees.map((employee) => (
                <option key={employee.id} value={employee.id}>
                  {employee.name}
                </option>
              ))}
            </select>
          </div>
        </div>
      </div>

      {/* Description */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          <FileText className="inline mr-2" size={16} />
          Order Description
        </label>
        <textarea
          rows={4}
          className="input-field resize-none"
          placeholder="Describe the garment(s) to be made, style, color, special requirements, etc."
          {...register("description", { required: "Description is required" })}
        />
        {errors.description && (
          <p className="mt-1 text-sm text-red-600">
            {errors.description.message}
          </p>
        )}
      </div>

      {/* Materials Section */}
      <MaterialSelector
        selectedMaterials={selectedMaterials}
        onChange={setSelectedMaterials}
      />

      {/* Pricing */}
      <div className="border-t border-gray-200 pt-6">
        <h3 className="font-semibold text-gray-900 mb-4">Pricing</h3>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          {/* Total Cost */}
          <div>
            <Input
              label="Total Cost (K)"
              type="number"
              step="0.01"
              placeholder="0.00"
              icon={DollarSign}
              error={errors.total_cost?.message}
              {...register("total_cost", {
                required: "Total cost is required",
                min: { value: 0, message: "Must be 0 or greater" },
              })}
            />
          </div>

          {/* Deposit */}
          <div>
            <Input
              label="Deposit (K)"
              type="number"
              step="0.01"
              placeholder="0.00"
              icon={DollarSign}
              error={errors.deposit?.message}
              {...register("deposit", {
                min: { value: 0, message: "Must be 0 or greater" },
              })}
            />
          </div>

          {/* Balance (Calculated) */}
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Balance (K)
            </label>
            <div
              className={`input-field bg-gray-50 font-bold ${
                balance > 0 ? "text-red-600" : "text-green-600"
              }`}
            >
              {balance.toFixed(2)}
            </div>
          </div>
        </div>
      </div>

      {/* Notes */}
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          Additional Notes (Optional)
        </label>
        <textarea
          rows={3}
          className="input-field resize-none"
          placeholder="Any additional information, special instructions, or reminders..."
          {...register("notes")}
        />
      </div>

      {/* Actions */}
      <div className="flex gap-3 justify-end pt-4 border-t border-gray-200">
        <Button
          type="button"
          variant="secondary"
          onClick={onCancel}
          disabled={loading}
        >
          Cancel
        </Button>
        <Button type="submit" loading={loading}>
          {order ? "Update Order" : "Create Order"}
        </Button>
      </div>

      {/* Warning about material deduction */}
      {!order && (
        <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
          <p className="text-sm text-yellow-800">
            <strong>Note:</strong> Materials will be automatically deducted from
            inventory when the order status is changed to "Production".
          </p>
        </div>
      )}
    </form>
  );
}


import { useState, useEffect } from "react";
import { Plus, Trash2, Package, AlertCircle } from "lucide-react";
import { useInventoryStore } from "../../store/useInventoryStore";
import Button from "../common/Button";
import Input from "../common/Input";

export default function MaterialSelector({ selectedMaterials = [], onChange }) {
  const { materials, fetchMaterials } = useInventoryStore();
  const [localMaterials, setLocalMaterials] = useState(selectedMaterials);

  useEffect(() => {
    fetchMaterials();
  }, [fetchMaterials]);

  useEffect(() => {
    setLocalMaterials(selectedMaterials);
  }, [selectedMaterials]);

  const addMaterial = () => {
    const newMaterial = {
      material_id: "",
      quantity_used: 0,
      cost: 0,
    };
    const updated = [...localMaterials, newMaterial];
    setLocalMaterials(updated);
    onChange(updated);
  };

  const removeMaterial = (index) => {
    const updated = localMaterials.filter((_, i) => i !== index);
    setLocalMaterials(updated);
    onChange(updated);
  };

  const updateMaterial = (index, field, value) => {
    const updated = [...localMaterials];
    updated[index][field] = value;

    // Auto-calculate cost when material or quantity changes
    if (field === "material_id" || field === "quantity_used") {
      const material = materials.find(
        (m) => m.id === updated[index].material_id
      );
      if (material && updated[index].quantity_used) {
        updated[index].cost =
          parseFloat(material.cost_per_unit) *
          parseFloat(updated[index].quantity_used);
      }
    }

    setLocalMaterials(updated);
    onChange(updated);
  };

  const getTotalCost = () => {
    return localMaterials.reduce((sum, m) => sum + parseFloat(m.cost || 0), 0);
  };

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <h3 className="font-semibold text-gray-900">Materials Required</h3>
        <Button
          type="button"
          variant="secondary"
          icon={Plus}
          onClick={addMaterial}
        >
          Add Material
        </Button>
      </div>

      {localMaterials.length === 0 ? (
        <div className="text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
          <Package className="mx-auto text-gray-400 mb-2" size={32} />
          <p className="text-gray-600 text-sm">No materials added yet</p>
          <p className="text-gray-500 text-xs mt-1">
            Click "Add Material" to get started
          </p>
        </div>
      ) : (
        <div className="space-y-3">
          {localMaterials.map((item, index) => {
            const material = materials.find((m) => m.id === item.material_id);
            const isLowStock =
              material &&
              parseFloat(material.stock_quantity) <
                parseFloat(item.quantity_used);

            return (
              <div
                key={index}
                className="p-4 bg-gray-50 rounded-lg border border-gray-200"
              >
                <div className="grid grid-cols-1 md:grid-cols-4 gap-3">
                  {/* Material Selection */}
                  <div className="md:col-span-2">
                    <label className="block text-xs font-medium text-gray-700 mb-1">
                      Material
                    </label>
                    <select
                      value={item.material_id}
                      onChange={(e) =>
                        updateMaterial(index, "material_id", e.target.value)
                      }
                      className="input-field text-sm"
                      required
                    >
                      <option value="">Select material...</option>
                      {materials.map((mat) => (
                        <option key={mat.id} value={mat.id}>
                          {mat.name} ({mat.stock_quantity} {mat.unit} available)
                        </option>
                      ))}
                    </select>
                  </div>

                  {/* Quantity */}
                  <div>
                    <label className="block text-xs font-medium text-gray-700 mb-1">
                      Quantity {material && `(${material.unit})`}
                    </label>
                    <Input
                      type="number"
                      step="0.01"
                      value={item.quantity_used}
                      onChange={(e) =>
                        updateMaterial(index, "quantity_used", e.target.value)
                      }
                      placeholder="0.00"
                      required
                    />
                  </div>

                  {/* Cost (Auto-calculated) */}
                  <div className="flex items-end gap-2">
                    <div className="flex-1">
                      <label className="block text-xs font-medium text-gray-700 mb-1">
                        Cost (K)
                      </label>
                      <Input
                        type="number"
                        step="0.01"
                        value={item.cost}
                        readOnly
                        className="bg-gray-100"
                      />
                    </div>
                    <Button
                      type="button"
                      variant="ghost"
                      onClick={() => removeMaterial(index)}
                      className="text-red-600 hover:bg-red-50 p-2"
                      icon={Trash2}
                    />
                  </div>
                </div>

                {/* Low Stock Warning */}
                {isLowStock && (
                  <div className="mt-2 flex items-center gap-2 text-xs text-red-600">
                    <AlertCircle size={14} />
                    <span>
                      Warning: Insufficient stock! Available:{" "}
                      {material.stock_quantity} {material.unit}
                    </span>
                  </div>
                )}

                {/* Material Info */}
                {material && (
                  <div className="mt-2 text-xs text-gray-600">
                    <span>
                      Cost per {material.unit}: K
                      {parseFloat(material.cost_per_unit).toFixed(2)}
                    </span>
                    <span className="mx-2">â€¢</span>
                    <span>Category: {material.category}</span>
                  </div>
                )}
              </div>
            );
          })}

          {/* Total Material Cost */}
          <div className="flex items-center justify-between p-4 bg-primary-50 rounded-lg border border-primary-200">
            <span className="font-semibold text-gray-900">
              Total Material Cost
            </span>
            <span className="text-xl font-bold text-primary-600">
              K{getTotalCost().toFixed(2)}
            </span>
          </div>
        </div>
      )}
    </div>
  );
}


import { motion } from "framer-motion";
import {
  Calendar,
  User,
  Package,
  DollarSign,
  Eye,
  Edit,
  Trash2,
} from "lucide-react";
import { format } from "date-fns";
import Button from "../common/Button";
import OrderStatusBadge from "./OrderStatusBadge";

export default function OrderCard({ order, onView, onEdit, onDelete }) {
  const progress = {
    enquiry: 15,
    contacted: 30,
    measurements: 45,
    production: 60,
    fitting: 75,
    completed: 90,
    delivered: 100,
  };

  const currentProgress = progress[order.status] || 0;

  return (
    <motion.div
      initial={{ opacity: 0, scale: 0.95 }}
      animate={{ opacity: 1, scale: 1 }}
      whileHover={{ y: -4 }}
      className="bg-white rounded-xl shadow-sm border border-gray-200 p-5 hover:shadow-md transition-all duration-200"
    >
      {/* Header */}
      <div className="flex items-start justify-between mb-4">
        <div>
          <h3 className="font-bold text-lg text-gray-900">
            {order.order_number}
          </h3>
          <p className="text-sm text-gray-600 mt-1">
            {format(new Date(order.order_date), "MMM dd, yyyy")}
          </p>
        </div>
        <OrderStatusBadge status={order.status} />
      </div>

      {/* Progress Bar */}
      <div className="mb-4">
        <div className="flex items-center justify-between text-xs text-gray-600 mb-2">
          <span>Progress</span>
          <span className="font-semibold">{currentProgress}%</span>
        </div>
        <div className="w-full h-2 bg-gray-200 rounded-full overflow-hidden">
          <motion.div
            initial={{ width: 0 }}
            animate={{ width: `${currentProgress}%` }}
            transition={{ duration: 0.5, ease: "easeOut" }}
            className="h-full bg-gradient-to-r from-primary-500 to-primary-600"
          />
        </div>
      </div>

      {/* Customer Info */}
      <div className="space-y-2 mb-4 pb-4 border-b border-gray-100">
        <div className="flex items-center gap-2 text-sm">
          <User size={16} className="text-gray-400" />
          <span className="text-gray-900 font-medium">
            {order.customers?.name || "N/A"}
          </span>
        </div>
        {order.customers?.phone && (
          <div className="flex items-center gap-2 text-sm text-gray-600">
            <span className="ml-6">{order.customers.phone}</span>
          </div>
        )}
      </div>

      {/* Order Details */}
      <div className="grid grid-cols-2 gap-3 mb-4">
        <div>
          <p className="text-xs text-gray-500 mb-1">Total Cost</p>
          <p className="font-bold text-gray-900">
            K{parseFloat(order.total_cost).toFixed(2)}
          </p>
        </div>
        <div>
          <p className="text-xs text-gray-500 mb-1">Balance</p>
          <p
            className={`font-bold ${order.balance > 0 ? "text-red-600" : "text-green-600"}`}
          >
            K{parseFloat(order.balance).toFixed(2)}
          </p>
        </div>
      </div>

      {/* Due Date */}
      {order.due_date && (
        <div className="flex items-center gap-2 text-sm text-gray-600 mb-4">
          <Calendar size={16} className="text-gray-400" />
          <span>Due: {format(new Date(order.due_date), "MMM dd, yyyy")}</span>
        </div>
      )}

      {/* Description */}
      {order.description && (
        <p className="text-sm text-gray-600 mb-4 line-clamp-2">
          {order.description}
        </p>
      )}

      {/* Actions */}
      <div className="flex gap-2">
        <Button
          variant="ghost"
          onClick={() => onView(order)}
          className="flex-1 text-primary-600 hover:bg-primary-50"
          icon={Eye}
        >
          View
        </Button>
        <Button
          variant="ghost"
          onClick={() => onEdit(order)}
          className="text-blue-600 hover:bg-blue-50"
          icon={Edit}
        />
        <Button
          variant="ghost"
          onClick={() => onDelete(order.id)}
          className="text-red-600 hover:bg-red-50"
          icon={Trash2}
        />
      </div>
    </motion.div>
  );
}


import { useState } from "react";
import { motion } from "framer-motion";
import { format } from "date-fns";
import {
  User,
  Phone,
  Mail,
  Calendar,
  DollarSign,
  Package,
  Scissors,
  FileText,
  Edit,
  ArrowRight,
} from "lucide-react";
import Card from "../common/Card";
import Button from "../common/Button";
import OrderStatusBadge from "./OrderStatusBadge";
import OrderTimeline from "./OrderTimeline";

const STATUS_FLOW = [
  "enquiry",
  "contacted",
  "measurements",
  "production",
  "fitting",
  "completed",
  "delivered",
];

export default function OrderDetailsView({ order, onEdit, onStatusChange }) {
  const [changingStatus, setChangingStatus] = useState(false);
  const [statusNotes, setStatusNotes] = useState("");

  const getNextStatus = () => {
    const currentIndex = STATUS_FLOW.indexOf(order.status);
    return currentIndex < STATUS_FLOW.length - 1
      ? STATUS_FLOW[currentIndex + 1]
      : null;
  };

  const handleStatusChange = async () => {
    const nextStatus = getNextStatus();
    if (!nextStatus) return;

    setChangingStatus(true);
    try {
      await onStatusChange(order.id, nextStatus, statusNotes);
      setStatusNotes("");
    } catch (error) {
      console.error(error);
    } finally {
      setChangingStatus(false);
    }
  };

  const nextStatus = getNextStatus();

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-start justify-between">
        <div>
          <h2 className="text-3xl font-bold text-gray-900 mb-2">
            {order.order_number}
          </h2>
          <p className="text-gray-600">
            Created on {format(new Date(order.order_date), "MMMM dd, yyyy")}
          </p>
        </div>
        <div className="flex gap-3">
          <OrderStatusBadge status={order.status} />
          <Button variant="secondary" icon={Edit} onClick={() => onEdit(order)}>
            Edit Order
          </Button>
        </div>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
        {/* Left Column - Details */}
        <div className="lg:col-span-2 space-y-6">
          {/* Customer Information */}
          <Card>
            <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <User size={20} className="text-primary-600" />
              Customer Information
            </h3>
            <div className="space-y-3">
              <div>
                <p className="text-sm text-gray-500">Name</p>
                <p className="font-semibold text-gray-900">
                  {order.customers?.name || "N/A"}
                </p>
              </div>
              {order.customers?.phone && (
                <div className="flex items-center gap-2">
                  <Phone size={16} className="text-gray-400" />
                  <p className="text-gray-900">{order.customers.phone}</p>
                </div>
              )}
              {order.customers?.email && (
                <div className="flex items-center gap-2">
                  <Mail size={16} className="text-gray-400" />
                  <p className="text-gray-900">{order.customers.email}</p>
                </div>
              )}
            </div>
          </Card>

          {/* Order Details */}
          <Card>
            <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <FileText size={20} className="text-primary-600" />
              Order Details
            </h3>
            <div className="space-y-4">
              <div>
                <p className="text-sm text-gray-500 mb-1">Description</p>
                <p className="text-gray-900">
                  {order.description || "No description provided"}
                </p>
              </div>

              {order.notes && (
                <div>
                  <p className="text-sm text-gray-500 mb-1">Notes</p>
                  <p className="text-gray-600 text-sm">{order.notes}</p>
                </div>
              )}

              <div className="grid grid-cols-2 gap-4 pt-4 border-t border-gray-100">
                <div>
                  <p className="text-sm text-gray-500 mb-1">Due Date</p>
                  <div className="flex items-center gap-2">
                    <Calendar size={16} className="text-gray-400" />
                    <p className="font-semibold text-gray-900">
                      {order.due_date
                        ? format(new Date(order.due_date), "MMM dd, yyyy")
                        : "Not set"}
                    </p>
                  </div>
                </div>

                {order.employees && (
                  <div>
                    <p className="text-sm text-gray-500 mb-1">
                      Assigned Tailor
                    </p>
                    <div className="flex items-center gap-2">
                      <Scissors size={16} className="text-gray-400" />
                      <p className="font-semibold text-gray-900">
                        {order.employees.name}
                      </p>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </Card>

          {/* Materials Used */}
          <Card>
            <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <Package size={20} className="text-primary-600" />
              Materials Used
            </h3>
            {order.materials && order.materials.length > 0 ? (
              <div className="space-y-3">
                {order.materials.map((item, index) => (
                  <motion.div
                    key={index}
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: index * 0.05 }}
                    className="flex items-center justify-between p-3 bg-gray-50 rounded-lg"
                  >
                    <div className="flex-1">
                      <p className="font-medium text-gray-900">
                        {item.materials?.name}
                      </p>
                      <p className="text-sm text-gray-600">
                        {parseFloat(item.quantity_used).toFixed(2)}{" "}
                        {item.materials?.unit}
                      </p>
                    </div>
                    <p className="font-semibold text-gray-900">
                      K{parseFloat(item.cost).toFixed(2)}
                    </p>
                  </motion.div>
                ))}
                <div className="flex items-center justify-between pt-3 border-t border-gray-200">
                  <span className="font-semibold text-gray-900">
                    Total Material Cost
                  </span>
                  <span className="text-lg font-bold text-primary-600">
                    K
                    {order.materials
                      .reduce((sum, m) => sum + parseFloat(m.cost), 0)
                      .toFixed(2)}
                  </span>
                </div>
              </div>
            ) : (
              <p className="text-gray-500 text-sm">No materials recorded</p>
            )}
          </Card>

          {/* Pricing Summary */}
          <Card>
            <h3 className="text-lg font-semibold text-gray-900 mb-4 flex items-center gap-2">
              <DollarSign size={20} className="text-primary-600" />
              Pricing Summary
            </h3>
            <div className="space-y-3">
              <div className="flex items-center justify-between">
                <span className="text-gray-600">Total Cost</span>
                <span className="font-semibold text-gray-900">
                  K{parseFloat(order.total_cost).toFixed(2)}
                </span>
              </div>
              <div className="flex items-center justify-between">
                <span className="text-gray-600">Deposit Paid</span>
                <span className="font-semibold text-green-600">
                  K{parseFloat(order.deposit).toFixed(2)}
                </span>
              </div>
              <div className="flex items-center justify-between pt-3 border-t border-gray-200">
                <span className="font-bold text-gray-900">Balance Due</span>
                <span
                  className={`text-xl font-bold ${
                    order.balance > 0 ? "text-red-600" : "text-green-600"
                  }`}
                >
                  K{parseFloat(order.balance).toFixed(2)}
                </span>
              </div>
            </div>
          </Card>
        </div>

        {/* Right Column - Timeline & Actions */}
        <div className="space-y-6">
          {/* Status Actions */}
          {nextStatus &&
            order.status !== "delivered" &&
            order.status !== "cancelled" && (
              <Card className="bg-gradient-to-br from-primary-50 to-white">
                <h3 className="font-semibold text-gray-900 mb-4">
                  Update Status
                </h3>

                <div className="mb-4">
                  <label className="block text-sm font-medium text-gray-700 mb-2">
                    Notes (Optional)
                  </label>
                  <textarea
                    rows={3}
                    className="input-field resize-none"
                    placeholder="Add notes about this status change..."
                    value={statusNotes}
                    onChange={(e) => setStatusNotes(e.target.value)}
                  />
                </div>

                <Button
                  onClick={handleStatusChange}
                  loading={changingStatus}
                  className="w-full"
                  icon={ArrowRight}
                >
                  Move to{" "}
                  {nextStatus.charAt(0).toUpperCase() + nextStatus.slice(1)}
                </Button>

                {nextStatus === "production" && (
                  <p className="text-xs text-yellow-700 mt-2 bg-yellow-50 p-2 rounded">
                    âš ï¸ Materials will be deducted from inventory
                  </p>
                )}
              </Card>
            )}

          {/* Order Timeline */}
          <Card>
            <h3 className="text-lg font-semibold text-gray-900 mb-6">
              Order Timeline
            </h3>
            <OrderTimeline
              timeline={order.timeline || []}
              currentStatus={order.status}
            />
          </Card>
        </div>
      </div>
    </div>
  );
}


import { motion } from "framer-motion";

export default function OrderStatusBadge({ status }) {
  const statusConfig = {
    enquiry: {
      label: "Enquiry",
      color: "bg-gray-100 text-gray-700 border-gray-300",
      dotColor: "bg-gray-500",
    },
    contacted: {
      label: "Contacted",
      color: "bg-blue-100 text-blue-700 border-blue-300",
      dotColor: "bg-blue-500",
    },
    measurements: {
      label: "Measurements",
      color: "bg-purple-100 text-purple-700 border-purple-300",
      dotColor: "bg-purple-500",
    },
    production: {
      label: "In Production",
      color: "bg-yellow-100 text-yellow-700 border-yellow-300",
      dotColor: "bg-yellow-500",
    },
    fitting: {
      label: "Fitting",
      color: "bg-orange-100 text-orange-700 border-orange-300",
      dotColor: "bg-orange-500",
    },
    completed: {
      label: "Completed",
      color: "bg-green-100 text-green-700 border-green-300",
      dotColor: "bg-green-500",
    },
    delivered: {
      label: "Delivered",
      color: "bg-emerald-100 text-emerald-700 border-emerald-300",
      dotColor: "bg-emerald-500",
    },
    cancelled: {
      label: "Cancelled",
      color: "bg-red-100 text-red-700 border-red-300",
      dotColor: "bg-red-500",
    },
  };

  const config = statusConfig[status] || statusConfig.enquiry;

  return (
    <motion.div
      initial={{ scale: 0.8, opacity: 0 }}
      animate={{ scale: 1, opacity: 1 }}
      className={`inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium border ${config.color}`}
    >
      <span
        className={`w-2 h-2 rounded-full ${config.dotColor} animate-pulse`}
      ></span>
      {config.label}
    </motion.div>
  );
}


import { motion } from "framer-motion";
import { format } from "date-fns";
import { Check, Circle } from "lucide-react";

const STATUSES = [
  { key: "enquiry", label: "Enquiry" },
  { key: "contacted", label: "Contacted" },
  { key: "measurements", label: "Measurements" },
  { key: "production", label: "Production" },
  { key: "fitting", label: "Fitting" },
  { key: "completed", label: "Completed" },
  { key: "delivered", label: "Delivered" },
];

export default function OrderTimeline({ timeline, currentStatus }) {
  const statusIndex = STATUSES.findIndex((s) => s.key === currentStatus);

  return (
    <div className="relative">
      {/* Timeline Line */}
      <div className="absolute left-4 top-0 bottom-0 w-0.5 bg-gray-200"></div>

      {/* Progress Line */}
      <motion.div
        initial={{ height: 0 }}
        animate={{ height: `${(statusIndex / (STATUSES.length - 1)) * 100}%` }}
        transition={{ duration: 0.5 }}
        className="absolute left-4 top-0 w-0.5 bg-primary-600"
      ></motion.div>

      {/* Timeline Items */}
      <div className="space-y-6">
        {STATUSES.map((status, index) => {
          const timelineEntry = timeline.find((t) => t.status === status.key);
          const isCompleted = index <= statusIndex;
          const isCurrent = index === statusIndex;

          return (
            <motion.div
              key={status.key}
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: index * 0.1 }}
              className="relative flex items-start gap-4"
            >
              {/* Status Icon */}
              <div
                className={`relative z-10 flex items-center justify-center w-8 h-8 rounded-full border-2 ${
                  isCompleted
                    ? "bg-primary-600 border-primary-600"
                    : "bg-white border-gray-300"
                }`}
              >
                {isCompleted ? (
                  <Check size={16} className="text-white" />
                ) : (
                  <Circle
                    size={8}
                    className={isCurrent ? "text-primary-600" : "text-gray-300"}
                  />
                )}
              </div>

              {/* Status Content */}
              <div className="flex-1 pb-6">
                <div className="flex items-center justify-between">
                  <h3
                    className={`font-semibold ${
                      isCompleted ? "text-gray-900" : "text-gray-500"
                    }`}
                  >
                    {status.label}
                  </h3>
                  {timelineEntry && (
                    <span className="text-xs text-gray-500">
                      {format(
                        new Date(timelineEntry.created_at),
                        "MMM dd, hh:mm a"
                      )}
                    </span>
                  )}
                </div>
                {timelineEntry?.notes && (
                  <p className="text-sm text-gray-600 mt-1">
                    {timelineEntry.notes}
                  </p>
                )}
                {isCurrent && !timelineEntry && (
                  <p className="text-sm text-primary-600 mt-1">
                    Current Status
                  </p>
                )}
              </div>
            </motion.div>
          );
        })}
      </div>
    </div>
  );
}


import { createClient } from "@supabase/supabase-js";

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL;
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY;

export const supabase = createClient(supabaseUrl, supabaseAnonKey);


import { useState, useEffect } from "react";
import { motion } from "framer-motion";
import { Plus, Search, User, TrendingUp, ShoppingCart } from "lucide-react";
import { useCustomerStore } from "../store/useCustomerStore";
import { customerService } from "../services/customerService";
import Card from "../components/common/Card";
import Button from "../components/common/Button";
import Modal from "../components/common/Modal";
import CustomerCard from "../components/customers/CustomerCard";
import AddCustomerForm from "../components/customers/AddCustomerForm";
import CustomerDetailsView from "../components/customers/CustomerDetailsView";
import toast from "react-hot-toast";

export default function Customers() {
  const {
    customers,
    loading,
    fetchCustomers,
    addCustomer,
    updateCustomer,
    deleteCustomer,
    updateMeasurements,
  } = useCustomerStore();

  const [showAddModal, setShowAddModal] = useState(false);
  const [editingCustomer, setEditingCustomer] = useState(null);
  const [viewingCustomer, setViewingCustomer] = useState(null);
  const [customerStats, setCustomerStats] = useState(null);
  const [searchTerm, setSearchTerm] = useState("");

  useEffect(() => {
    fetchCustomers();
  }, [fetchCustomers]);

  // Filter customers
  const filteredCustomers = customers.filter(
    (customer) =>
      customer.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      customer.phone?.toLowerCase().includes(searchTerm.toLowerCase()) ||
      customer.email?.toLowerCase().includes(searchTerm.toLowerCase())
  );

  // Calculate overall stats
  const totalCustomers = customers.length;
  const customersWithMeasurements = customers.filter(
    (c) => c.measurements
  ).length;

  const handleAddCustomer = async (data) => {
    await addCustomer(data);
    setShowAddModal(false);
  };

  const handleUpdateCustomer = async (data) => {
    await updateCustomer(editingCustomer.id, data);
    setEditingCustomer(null);
  };

  const handleDeleteCustomer = async (id) => {
    if (window.confirm("Are you sure you want to delete this customer?")) {
      await deleteCustomer(id);
    }
  };

  const handleViewCustomer = async (customer) => {
    try {
      // Fetch full customer data with orders
      const fullCustomer = await customerService.getCustomerWithOrders(
        customer.id
      );
      const stats = await customerService.getCustomerStats(customer.id);

      setViewingCustomer(fullCustomer);
      setCustomerStats(stats);
    } catch (error) {
      toast.error("Failed to load customer details");
    }
  };

  const handleEditCustomer = (customer) => {
    setEditingCustomer(customer);
    setViewingCustomer(null);
  };

  const handleUpdateMeasurements = async (customerId, measurements) => {
    await updateMeasurements(customerId, measurements);
    // Refresh customer details
    const fullCustomer =
      await customerService.getCustomerWithOrders(customerId);
    setViewingCustomer(fullCustomer);
  };

  if (loading && customers.length === 0) {
    return (
      <div className="flex items-center justify-center h-full">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading customers...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-gray-900 mb-2">
            Customer Management
          </h1>
          <p className="text-gray-600">
            Manage your customers and their information
          </p>
        </div>
        <Button onClick={() => setShowAddModal(true)} icon={Plus}>
          Add Customer
        </Button>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <Card>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600 mb-1">Total Customers</p>
              <p className="text-3xl font-bold text-gray-900">
                {totalCustomers}
              </p>
            </div>
            <div className="w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center">
              <User className="text-primary-600" size={24} />
            </div>
          </div>
        </Card>

        <Card>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600 mb-1">With Measurements</p>
              <p className="text-3xl font-bold text-gray-900">
                {customersWithMeasurements}
              </p>
            </div>
            <div className="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
              <TrendingUp className="text-green-600" size={24} />
            </div>
          </div>
        </Card>

        <Card>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600 mb-1">New This Month</p>
              <p className="text-3xl font-bold text-gray-900">
                {
                  customers.filter((c) => {
                    const created = new Date(c.created_at);
                    const now = new Date();
                    return (
                      created.getMonth() === now.getMonth() &&
                      created.getFullYear() === now.getFullYear()
                    );
                  }).length
                }
              </p>
            </div>
            <div className="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
              <ShoppingCart className="text-blue-600" size={24} />
            </div>
          </div>
        </Card>
      </div>

      {/* Search */}
      <Card>
        <div className="relative">
          <Search
            className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
            size={20}
          />
          <input
            type="search"
            placeholder="Search customers by name, phone, or email..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
          />
        </div>
      </Card>

      {/* Customer List */}
      {filteredCustomers.length === 0 ? (
        <Card className="text-center py-12">
          <User className="mx-auto text-gray-400 mb-4" size={48} />
          <h3 className="text-xl font-semibold text-gray-900 mb-2">
            No customers found
          </h3>
          <p className="text-gray-600 mb-6">
            {searchTerm
              ? "Try adjusting your search"
              : "Get started by adding your first customer"}
          </p>
          {!searchTerm && (
            <Button onClick={() => setShowAddModal(true)} icon={Plus}>
              Add Your First Customer
            </Button>
          )}
        </Card>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {filteredCustomers.map((customer) => (
            <CustomerCard
              key={customer.id}
              customer={customer}
              onView={handleViewCustomer}
              onEdit={handleEditCustomer}
              onDelete={handleDeleteCustomer}
            />
          ))}
        </div>
      )}

      {/* Add Customer Modal */}
      <Modal
        isOpen={showAddModal}
        onClose={() => setShowAddModal(false)}
        title="Add New Customer"
      >
        <AddCustomerForm
          onSubmit={handleAddCustomer}
          onCancel={() => setShowAddModal(false)}
        />
      </Modal>

      {/* Edit Customer Modal */}
      <Modal
        isOpen={!!editingCustomer}
        onClose={() => setEditingCustomer(null)}
        title="Edit Customer"
      >
        <AddCustomerForm
          customer={editingCustomer}
          onSubmit={handleUpdateCustomer}
          onCancel={() => setEditingCustomer(null)}
        />
      </Modal>

      {/* View Customer Modal */}
      <Modal
        isOpen={!!viewingCustomer}
        onClose={() => {
          setViewingCustomer(null);
          setCustomerStats(null);
        }}
        title="Customer Details"
        size="xl"
      >
        {viewingCustomer && (
          <CustomerDetailsView
            customer={viewingCustomer}
            stats={customerStats}
            onEdit={handleEditCustomer}
            onUpdateMeasurements={handleUpdateMeasurements}
          />
        )}
      </Modal>
    </div>
  );
}


import { useState, useEffect } from "react";
import { motion } from "framer-motion";
import {
  ShoppingCart,
  Users,
  Package,
  TrendingUp,
  Clock,
  AlertCircle,
  DollarSign,
  Calendar,
} from "lucide-react";
import Card from "../components/common/Card";
import RevenueChart from "../components/dashboard/RevenueChart";
import OrderStatusChart from "../components/dashboard/OrderStatusChart";
import MaterialUsageChart from "../components/dashboard/MaterialUsageChart";
import EmployeeProductivityChart from "../components/dashboard/EmployeeProductivityChart";
import { analyticsService } from "../services/analyticsService";
import { orderService } from "../services/orderService";
import { inventoryService } from "../services/inventoryService";
import { employeeService } from "../services/employeeService";
import { format } from "date-fns";
import OrderStatusBadge from "../components/orders/OrderStatusBadge";

export default function Dashboard() {
  const [loading, setLoading] = useState(true);
  const [dashboardData, setDashboardData] = useState({
    stats: null,
    revenueData: [],
    orderStatusData: [],
    materialUsageData: [],
    employeeProductivityData: [],
    recentOrders: [],
    lowStock: [],
    todayAttendance: [],
  });

  useEffect(() => {
    fetchDashboardData();
  }, []);

  const fetchDashboardData = async () => {
    setLoading(true);
    try {
      const [
        stats,
        revenueData,
        orderStatusData,
        materialUsageData,
        employeeProductivityData,
        allOrders,
        lowStockMaterials,
        todayAttendance,
      ] = await Promise.all([
        analyticsService.getDashboardStats(),
        analyticsService.getRevenueData(),
        analyticsService.getOrderStatusData(),
        analyticsService.getTopMaterialsUsed(8),
        analyticsService.getEmployeeProductivity(),
        orderService.getAllOrders(),
        inventoryService.getLowStockMaterials(),
        employeeService.getTodayAttendance(),
      ]);

      setDashboardData({
        stats,
        revenueData,
        orderStatusData,
        materialUsageData,
        employeeProductivityData,
        recentOrders: allOrders.slice(0, 5),
        lowStock: lowStockMaterials,
        todayAttendance,
      });
    } catch (error) {
      console.error("Failed to fetch dashboard data:", error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center h-full">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading dashboard...</p>
        </div>
      </div>
    );
  }

  const { stats } = dashboardData;
  const clockedInToday = dashboardData.todayAttendance.filter(
    (a) => !a.clock_out
  ).length;
  const revenueGrowth =
    stats.thisMonthRevenue > 0
      ? ((stats.thisMonthRevenue / stats.totalRevenue) * 100).toFixed(1)
      : 0;

  return (
    <div className="space-y-6">
      {/* Header */}
      <div>
        <h1 className="text-3xl font-bold text-gray-900 mb-2">Dashboard</h1>
        <p className="text-gray-600">
          Welcome back! Here's what's happening with your business.
        </p>
      </div>

      {/* Main Stats Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.1 }}
        >
          <Card className="bg-gradient-to-br from-blue-50 to-white">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-blue-600 mb-1">Total Revenue</p>
                <p className="text-3xl font-bold text-blue-900">
                  K{stats.totalRevenue.toFixed(0)}
                </p>
                <p className="text-xs text-blue-600 mt-1">
                  K{stats.thisMonthRevenue.toFixed(0)} this month
                </p>
              </div>
              <div className="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                <DollarSign className="text-blue-600" size={24} />
              </div>
            </div>
          </Card>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.2 }}
        >
          <Card className="bg-gradient-to-br from-green-50 to-white">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-green-600 mb-1">Total Orders</p>
                <p className="text-3xl font-bold text-green-900">
                  {stats.totalOrders}
                </p>
                <p className="text-xs text-green-600 mt-1">
                  {stats.activeOrders} active
                </p>
              </div>
              <div className="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                <ShoppingCart className="text-green-600" size={24} />
              </div>
            </div>
          </Card>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.3 }}
        >
          <Card className="bg-gradient-to-br from-purple-50 to-white">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-purple-600 mb-1">Customers</p>
                <p className="text-3xl font-bold text-purple-900">
                  {stats.totalCustomers}
                </p>
                <p className="text-xs text-purple-600 mt-1">Total registered</p>
              </div>
              <div className="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                <Users className="text-purple-600" size={24} />
              </div>
            </div>
          </Card>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.4 }}
        >
          <Card
            className={`bg-gradient-to-br ${
              stats.lowStockCount > 0
                ? "from-red-50 to-white"
                : "from-green-50 to-white"
            }`}
          >
            <div className="flex items-center justify-between">
              <div>
                <p
                  className={`text-sm mb-1 ${
                    stats.lowStockCount > 0 ? "text-red-600" : "text-green-600"
                  }`}
                >
                  Low Stock Items
                </p>
                <p
                  className={`text-3xl font-bold ${
                    stats.lowStockCount > 0 ? "text-red-900" : "text-green-900"
                  }`}
                >
                  {stats.lowStockCount}
                </p>
                <p
                  className={`text-xs mt-1 ${
                    stats.lowStockCount > 0 ? "text-red-600" : "text-green-600"
                  }`}
                >
                  {stats.lowStockCount > 0 ? "Needs attention" : "All good!"}
                </p>
              </div>
              <div
                className={`w-12 h-12 rounded-lg flex items-center justify-center ${
                  stats.lowStockCount > 0 ? "bg-red-100" : "bg-green-100"
                }`}
              >
                {stats.lowStockCount > 0 ? (
                  <AlertCircle className="text-red-600" size={24} />
                ) : (
                  <Package className="text-green-600" size={24} />
                )}
              </div>
            </div>
          </Card>
        </motion.div>
      </div>

      {/* Charts Section */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <RevenueChart data={dashboardData.revenueData} />
        <OrderStatusChart data={dashboardData.orderStatusData} />
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <MaterialUsageChart data={dashboardData.materialUsageData} />
        <EmployeeProductivityChart
          data={dashboardData.employeeProductivityData}
        />
      </div>

      {/* Recent Activity Section */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* Recent Orders */}
        <Card>
          <div className="flex items-center justify-between mb-4">
            <h2 className="text-xl font-bold text-gray-900">Recent Orders</h2>
            <a
              href="/orders"
              className="text-sm text-primary-600 hover:text-primary-700"
            >
              View all â†’
            </a>
          </div>
          {dashboardData.recentOrders.length === 0 ? (
            <p className="text-gray-500 text-center py-8">No orders yet</p>
          ) : (
            <div className="space-y-3">
              {dashboardData.recentOrders.map((order, index) => (
                <motion.div
                  key={order.id}
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: index * 0.05 }}
                  className="flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"
                >
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-1">
                      <p className="font-semibold text-gray-900">
                        {order.order_number}
                      </p>
                      <OrderStatusBadge status={order.status} />
                    </div>
                    <p className="text-sm text-gray-600">
                      {order.customers?.name}
                    </p>
                    <p className="text-xs text-gray-500 flex items-center gap-1 mt-1">
                      <Calendar size={12} />
                      {format(new Date(order.order_date), "MMM dd, yyyy")}
                    </p>
                  </div>
                  <div className="text-right">
                    <p className="font-bold text-gray-900">
                      K{parseFloat(order.total_cost).toFixed(2)}
                    </p>
                  </div>
                </motion.div>
              ))}
            </div>
          )}
        </Card>

        {/* Low Stock Alerts & Today's Attendance */}
        <div className="space-y-6">
          {/* Low Stock */}
          <Card>
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-bold text-gray-900 flex items-center gap-2">
                {stats.lowStockCount > 0 && (
                  <AlertCircle className="text-red-600" size={20} />
                )}
                Low Stock Alerts
              </h2>
              <a
                href="/inventory"
                className="text-sm text-primary-600 hover:text-primary-700"
              >
                View all â†’
              </a>
            </div>
            {dashboardData.lowStock.length === 0 ? (
              <div className="text-center py-6">
                <Package className="mx-auto text-green-500 mb-2" size={32} />
                <p className="text-green-600 font-medium">
                  All materials well stocked!
                </p>
              </div>
            ) : (
              <div className="space-y-2">
                {dashboardData.lowStock.slice(0, 3).map((material, index) => (
                  <motion.div
                    key={material.id}
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: index * 0.05 }}
                    className="flex items-center justify-between p-3 bg-red-50 rounded-lg border border-red-200"
                  >
                    <div>
                      <p className="font-semibold text-gray-900 text-sm">
                        {material.name}
                      </p>
                      <p className="text-xs text-gray-600 capitalize">
                        {material.category}
                      </p>
                    </div>
                    <div className="text-right">
                      <p className="font-bold text-red-600 text-sm">
                        {parseFloat(material.stock_quantity).toFixed(1)}{" "}
                        {material.unit}
                      </p>
                    </div>
                  </motion.div>
                ))}
              </div>
            )}
          </Card>

          {/* Today's Attendance */}
          <Card>
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-bold text-gray-900">
                Today's Attendance
              </h2>
              <span className="text-sm font-medium text-gray-600">
                {clockedInToday} clocked in
              </span>
            </div>
            {dashboardData.todayAttendance.length === 0 ? (
              <p className="text-gray-500 text-center py-6">
                No attendance today
              </p>
            ) : (
              <div className="space-y-2">
                {dashboardData.todayAttendance
                  .slice(0, 4)
                  .map((record, index) => (
                    <motion.div
                      key={record.id}
                      initial={{ opacity: 0, x: -20 }}
                      animate={{ opacity: 1, x: 0 }}
                      transition={{ delay: index * 0.05 }}
                      className={`flex items-center justify-between p-2 rounded-lg ${
                        record.clock_out ? "bg-gray-50" : "bg-green-50"
                      }`}
                    >
                      <span className="text-sm font-medium text-gray-900">
                        {record.employees.name}
                      </span>
                      {record.clock_out ? (
                        <span className="text-xs text-gray-600">
                          {parseFloat(record.hours_worked).toFixed(1)}h
                        </span>
                      ) : (
                        <span className="text-xs font-medium text-green-600">
                          Active
                        </span>
                      )}
                    </motion.div>
                  ))}
              </div>
            )}
          </Card>
        </div>
      </div>
    </div>
  );
}


import { useState, useEffect } from "react";
import { motion } from "framer-motion";
import { Plus, Users, Clock, TrendingUp, Search } from "lucide-react";
import { useEmployeeStore } from "../store/useEmployeeStore";
import Card from "../components/common/Card";
import Button from "../components/common/Button";
import Modal from "../components/common/Modal";
import EmployeeCard from "../components/employees/EmployeeCard";
import AddEmployeeForm from "../components/employees/AddEmployeeForm";
import ClockInOut from "../components/employees/ClockInOut";
import TodayAttendance from "../components/employees/TodayAttendance";
import AttendanceTable from "../components/employees/AttendanceTable";

export default function Employees() {
  const {
    employees,
    todayAttendance,
    loading,
    fetchEmployees,
    fetchTodayAttendance,
    addEmployee,
    updateEmployee,
    deleteEmployee,
  } = useEmployeeStore();

  const [showAddModal, setShowAddModal] = useState(false);
  const [editingEmployee, setEditingEmployee] = useState(null);
  const [viewingAttendance, setViewingAttendance] = useState(null);
  const [searchTerm, setSearchTerm] = useState("");

  useEffect(() => {
    fetchEmployees();
    fetchTodayAttendance();
  }, [fetchEmployees, fetchTodayAttendance]);

  // Calculate stats
  const activeEmployees = employees.filter((e) => e.active).length;
  const clockedInToday = todayAttendance.filter((a) => !a.clock_out).length;
  const totalHoursToday = todayAttendance.reduce(
    (sum, a) => sum + parseFloat(a.hours_worked || 0),
    0
  );

  // Filter employees
  const filteredEmployees = employees.filter(
    (employee) =>
      employee.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      employee.role.toLowerCase().includes(searchTerm.toLowerCase()) ||
      employee.email?.toLowerCase().includes(searchTerm.toLowerCase())
  );

  const handleAddEmployee = async (data) => {
    await addEmployee(data);
    setShowAddModal(false);
  };

  const handleUpdateEmployee = async (data) => {
    await updateEmployee(editingEmployee.id, data);
    setEditingEmployee(null);
  };

  const handleDeleteEmployee = async (id) => {
    if (window.confirm("Are you sure you want to deactivate this employee?")) {
      await deleteEmployee(id);
    }
  };

  const handleClockAction = () => {
    fetchTodayAttendance();
  };

  if (loading && employees.length === 0) {
    return (
      <div className="flex items-center justify-center h-full">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading employees...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-gray-900 mb-2">
            Employee Management
          </h1>
          <p className="text-gray-600">Manage employees and track attendance</p>
        </div>
        <Button onClick={() => setShowAddModal(true)} icon={Plus}>
          Add Employee
        </Button>
      </div>

      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <Card>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600 mb-1">Active Employees</p>
              <p className="text-3xl font-bold text-gray-900">
                {activeEmployees}
              </p>
            </div>
            <div className="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
              <Users className="text-blue-600" size={24} />
            </div>
          </div>
        </Card>

        <Card>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600 mb-1">Clocked In Today</p>
              <p className="text-3xl font-bold text-gray-900">
                {clockedInToday}
              </p>
            </div>
            <div className="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
              <Clock className="text-green-600" size={24} />
            </div>
          </div>
        </Card>

        <Card>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600 mb-1">Hours Today</p>
              <p className="text-3xl font-bold text-gray-900">
                {totalHoursToday.toFixed(1)}
              </p>
            </div>
            <div className="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
              <TrendingUp className="text-purple-600" size={24} />
            </div>
          </div>
        </Card>
      </div>

      {/* Clock In/Out and Today's Attendance */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <ClockInOut employees={employees} onClockAction={handleClockAction} />
        <TodayAttendance attendance={todayAttendance} />
      </div>

      {/* Employee List Section */}
      <Card>
        <div className="flex items-center justify-between mb-6">
          <h2 className="text-xl font-bold text-gray-900">All Employees</h2>
          <div className="relative flex-1 max-w-md ml-4">
            <Search
              className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
              size={20}
            />
            <input
              type="search"
              placeholder="Search employees..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
            />
          </div>
        </div>

        {filteredEmployees.length === 0 ? (
          <div className="text-center py-12">
            <Users className="mx-auto text-gray-400 mb-4" size={48} />
            <h3 className="text-xl font-semibold text-gray-900 mb-2">
              No employees found
            </h3>
            <p className="text-gray-600 mb-6">
              {searchTerm
                ? "Try adjusting your search"
                : "Get started by adding your first employee"}
            </p>
            {!searchTerm && (
              <Button onClick={() => setShowAddModal(true)} icon={Plus}>
                Add Your First Employee
              </Button>
            )}
          </div>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredEmployees.map((employee) => (
              <EmployeeCard
                key={employee.id}
                employee={employee}
                onEdit={setEditingEmployee}
                onDeactivate={handleDeleteEmployee}
                onViewDetails={setViewingAttendance}
              />
            ))}
          </div>
        )}
      </Card>

      {/* Add Employee Modal */}
      <Modal
        isOpen={showAddModal}
        onClose={() => setShowAddModal(false)}
        title="Add New Employee"
      >
        <AddEmployeeForm
          onSubmit={handleAddEmployee}
          onCancel={() => setShowAddModal(false)}
        />
      </Modal>

      {/* Edit Employee Modal */}
      <Modal
        isOpen={!!editingEmployee}
        onClose={() => setEditingEmployee(null)}
        title="Edit Employee"
      >
        <AddEmployeeForm
          employee={editingEmployee}
          onSubmit={handleUpdateEmployee}
          onCancel={() => setEditingEmployee(null)}
        />
      </Modal>

      {/* View Attendance Modal */}
      <Modal
        isOpen={!!viewingAttendance}
        onClose={() => setViewingAttendance(null)}
        title="Attendance Records"
        size="lg"
      >
        {viewingAttendance && <AttendanceTable employee={viewingAttendance} />}
      </Modal>
    </div>
  );
}


import { useState, useEffect } from "react";
import { motion } from "framer-motion";
import {
  Plus,
  Search,
  Filter,
  Package,
  TrendingUp,
  AlertCircle,
} from "lucide-react";
import { useInventoryStore } from "../store/useInventoryStore";
import Card from "../components/common/Card";
import Button from "../components/common/Button";
import Modal from "../components/common/Modal";
import MaterialCard from "../components/inventory/MaterialCard";
import AddMaterialForm from "../components/inventory/AddMaterialForm";
import StockUpdateModal from "../components/inventory/StockUpdateModal";
import LowStockAlert from "../components/inventory/LowStockAlert";

export default function Inventory() {
  const {
    materials,
    loading,
    fetchMaterials,
    addMaterial,
    updateMaterial,
    deleteMaterial,
    updateStock,
  } = useInventoryStore();

  const [showAddModal, setShowAddModal] = useState(false);
  const [editingMaterial, setEditingMaterial] = useState(null);
  const [stockUpdateModal, setStockUpdateModal] = useState({
    isOpen: false,
    material: null,
    operation: null,
  });
  const [searchTerm, setSearchTerm] = useState("");
  const [filterCategory, setFilterCategory] = useState("all");

  useEffect(() => {
    fetchMaterials();
  }, [fetchMaterials]);

  // Calculate stats
  const totalMaterials = materials.length;
  const totalValue = materials.reduce(
    (sum, m) =>
      sum + parseFloat(m.stock_quantity) * parseFloat(m.cost_per_unit),
    0
  );
  const lowStockItems = materials.filter(
    (m) => parseFloat(m.stock_quantity) <= parseFloat(m.min_stock_level)
  );

  // Filter materials
  const filteredMaterials = materials.filter((material) => {
    const matchesSearch =
      material.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      material.category.toLowerCase().includes(searchTerm.toLowerCase()) ||
      material.supplier?.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesCategory =
      filterCategory === "all" || material.category === filterCategory;
    return matchesSearch && matchesCategory;
  });

  // Get unique categories
  const categories = ["all", ...new Set(materials.map((m) => m.category))];

  const handleAddMaterial = async (data) => {
    await addMaterial(data);
    setShowAddModal(false);
  };

  const handleUpdateMaterial = async (data) => {
    await updateMaterial(editingMaterial.id, data);
    setEditingMaterial(null);
  };

  const handleDeleteMaterial = async (id) => {
    if (window.confirm("Are you sure you want to delete this material?")) {
      await deleteMaterial(id);
    }
  };

  const handleStockUpdate = async (id, quantity, operation) => {
    await updateStock(id, quantity, operation);
  };

  const openStockUpdateModal = (material, operation) => {
    setStockUpdateModal({ isOpen: true, material, operation });
  };

  if (loading && materials.length === 0) {
    return (
      <div className="flex items-center justify-center h-full">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading materials...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-gray-900 mb-2">
            Inventory Management
          </h1>
          <p className="text-gray-600">
            Manage your materials and track stock levels
          </p>
        </div>
        <Button onClick={() => setShowAddModal(true)} icon={Plus}>
          Add Material
        </Button>
      </div>
      {/* Stats Cards */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
        <Card>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600 mb-1">Total Materials</p>
              <p className="text-3xl font-bold text-gray-900">
                {totalMaterials}
              </p>
            </div>
            <div className="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
              <Package className="text-blue-600" size={24} />
            </div>
          </div>
        </Card>

        <Card>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600 mb-1">
                Total Inventory Value
              </p>
              <p className="text-3xl font-bold text-gray-900">
                K{totalValue.toFixed(2)}
              </p>
            </div>
            <div className="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
              <TrendingUp className="text-green-600" size={24} />
            </div>
          </div>
        </Card>

        <Card>
          <div className="flex items-center justify-between">
            <div>
              <p className="text-sm text-gray-600 mb-1">Low Stock Items</p>
              <p className="text-3xl font-bold text-red-600">
                {lowStockItems.length}
              </p>
            </div>
            <div className="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
              <AlertCircle className="text-red-600" size={24} />
            </div>
          </div>
        </Card>
      </div>

      {/* Low Stock Alert */}
      {lowStockItems.length > 0 && (
        <LowStockAlert
          materials={lowStockItems}
          onViewMaterial={(material) => setEditingMaterial(material)}
        />
      )}

      {/* Search and Filter */}
      <Card>
        <div className="flex flex-col md:flex-row gap-4">
          {/* Search */}
          <div className="flex-1 relative">
            <Search
              className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
              size={20}
            />
            <input
              type="search"
              placeholder="Search materials by name, category, or supplier..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
            />
          </div>

          {/* Category Filter */}
          <div className="flex items-center gap-2">
            <Filter size={20} className="text-gray-500" />
            <select
              value={filterCategory}
              onChange={(e) => setFilterCategory(e.target.value)}
              className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
            >
              {categories.map((category) => (
                <option key={category} value={category}>
                  {category === "all"
                    ? "All Categories"
                    : category.charAt(0).toUpperCase() + category.slice(1)}
                </option>
              ))}
            </select>
          </div>
        </div>
      </Card>

      {/* Materials Grid */}
      {filteredMaterials.length === 0 ? (
        <Card className="text-center py-12">
          <Package className="mx-auto text-gray-400 mb-4" size={48} />
          <h3 className="text-xl font-semibold text-gray-900 mb-2">
            No materials found
          </h3>
          <p className="text-gray-600 mb-6">
            {searchTerm || filterCategory !== "all"
              ? "Try adjusting your search or filters"
              : "Get started by adding your first material"}
          </p>
          {!searchTerm && filterCategory === "all" && (
            <Button onClick={() => setShowAddModal(true)} icon={Plus}>
              Add Your First Material
            </Button>
          )}
        </Card>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {filteredMaterials.map((material) => (
            <MaterialCard
              key={material.id}
              material={material}
              onEdit={setEditingMaterial}
              onDelete={handleDeleteMaterial}
              onUpdateStock={openStockUpdateModal}
            />
          ))}
        </div>
      )}

      {/* Add Material Modal */}
      <Modal
        isOpen={showAddModal}
        onClose={() => setShowAddModal(false)}
        title="Add New Material"
      >
        <AddMaterialForm
          onSubmit={handleAddMaterial}
          onCancel={() => setShowAddModal(false)}
        />
      </Modal>

      {/* Edit Material Modal */}
      <Modal
        isOpen={!!editingMaterial}
        onClose={() => setEditingMaterial(null)}
        title="Edit Material"
      >
        <AddMaterialForm
          material={editingMaterial}
          onSubmit={handleUpdateMaterial}
          onCancel={() => setEditingMaterial(null)}
        />
      </Modal>

      {/* Stock Update Modal */}
      <StockUpdateModal
        isOpen={stockUpdateModal.isOpen}
        onClose={() =>
          setStockUpdateModal({
            isOpen: false,
            material: null,
            operation: null,
          })
        }
        material={stockUpdateModal.material}
        operation={stockUpdateModal.operation}
        onUpdate={handleStockUpdate}
      />
    </div>
  );
}


import { useState } from "react";
import { useNavigate, useLocation, Link } from "react-router-dom";
import { useForm } from "react-hook-form";
import { motion } from "framer-motion";
import { Mail, Lock, Scissors, Eye, EyeOff } from "lucide-react";
import { useAuthStore } from "../store/useAuthStore";
import Input from "../components/common/Input";
import Button from "../components/common/Button";

export default function Login() {
  const [showPassword, setShowPassword] = useState(false);
  const [loading, setLoading] = useState(false);
  const navigate = useNavigate();
  const location = useLocation();
  const signIn = useAuthStore((state) => state.signIn);

  const from = location.state?.from?.pathname || "/dashboard";

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm();

  const onSubmit = async (data) => {
    setLoading(true);
    try {
      await signIn(data.email, data.password);
      navigate(from, { replace: true });
    } catch (error) {
      console.error("Login error:", error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary-50 via-white to-purple-50 flex items-center justify-center p-4">
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        className="w-full max-w-md"
      >
        {/* Logo */}
        <div className="text-center mb-8">
          <div className="inline-flex items-center justify-center w-16 h-16 bg-primary-600 rounded-2xl mb-4">
            <Scissors className="text-white" size={32} />
          </div>
          <h1 className="text-3xl font-bold text-gray-900 mb-2">
            Gloriaz Daughter
          </h1>
          <p className="text-gray-600">Sign in to your account</p>
        </div>

        {/* Login Form */}
        <div className="bg-white rounded-2xl shadow-xl p-8">
          <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
            {/* Email */}
            <Input
              label="Email Address"
              type="email"
              placeholder="you@example.com"
              icon={Mail}
              error={errors.email?.message}
              {...register("email", {
                required: "Email is required",
                pattern: {
                  value: /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i,
                  message: "Invalid email address",
                },
              })}
            />

            {/* Password */}
            <div>
              <label className="block text-sm font-medium text-gray-700 mb-2">
                Password
              </label>
              <div className="relative">
                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                  <Lock size={20} />
                </div>
                <input
                  type={showPassword ? "text" : "password"}
                  className={`input-field pl-10 pr-10 ${
                    errors.password ? "border-red-500" : ""
                  }`}
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  {...register("password", {
                    required: "Password is required",
                    minLength: {
                      value: 6,
                      message: "Password must be at least 6 characters",
                    },
                  })}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
                >
                  {showPassword ? <EyeOff size={20} /> : <Eye size={20} />}
                </button>
              </div>
              {errors.password && (
                <p className="mt-1 text-sm text-red-600">
                  {errors.password.message}
                </p>
              )}
            </div>

            {/* Remember & Forgot */}
            <div className="flex items-center justify-between">
              <label className="flex items-center">
                <input
                  type="checkbox"
                  className="w-4 h-4 text-primary-600 border-gray-300 rounded focus:ring-primary-500"
                />
                <span className="ml-2 text-sm text-gray-600">Remember me</span>
              </label>
              <Link
                to="/forgot-password"
                className="text-sm text-primary-600 hover:text-primary-700"
              >
                Forgot password?
              </Link>
            </div>

            {/* Submit Button */}
            <Button type="submit" loading={loading} className="w-full">
              Sign In
            </Button>
          </form>

          {/* Sign Up Link */}
          <div className="mt-6 text-center">
            <p className="text-sm text-gray-600">
              Don't have an account?{" "}
              <Link
                to="/signup"
                className="text-primary-600 hover:text-primary-700 font-medium"
              >
                Contact your administrator
              </Link>
            </p>
          </div>
        </div>

        {/* Footer */}
        <p className="text-center text-sm text-gray-500 mt-8">
          Â© 2024 Gloriaz Daughter. All rights reserved.
        </p>
      </motion.div>
    </div>
  );
}


import { useState, useEffect } from "react";
import { motion } from "framer-motion";
import {
  Plus,
  Search,
  Filter,
  ShoppingCart,
  TrendingUp,
  Clock,
} from "lucide-react";
import { useOrderStore } from "../store/useOrderStore";
import { orderService } from "../services/orderService";
import Card from "../components/common/Card";
import Button from "../components/common/Button";
import Modal from "../components/common/Modal";
import OrderCard from "../components/orders/OrderCard";
import CreateOrderForm from "../components/orders/CreateOrderForm";
import OrderDetailsView from "../components/orders/OrderDetailsView";
import toast from "react-hot-toast";

const STATUS_FILTERS = [
  { key: "all", label: "All Orders" },
  { key: "enquiry", label: "Enquiry" },
  { key: "contacted", label: "Contacted" },
  { key: "measurements", label: "Measurements" },
  { key: "production", label: "Production" },
  { key: "fitting", label: "Fitting" },
  { key: "completed", label: "Completed" },
  { key: "delivered", label: "Delivered" },
];

export default function Orders() {
  const {
    orders,
    loading,
    fetchOrders,
    createOrder,
    updateOrderStatus,
    deleteOrder,
  } = useOrderStore();

  const [showCreateModal, setShowCreateModal] = useState(false);
  const [viewingOrder, setViewingOrder] = useState(null);
  const [editingOrder, setEditingOrder] = useState(null);
  const [searchTerm, setSearchTerm] = useState("");
  const [statusFilter, setStatusFilter] = useState("all");
  const [stats, setStats] = useState(null);

  useEffect(() => {
    fetchOrders();
    fetchStats();
  }, [fetchOrders]);

  const fetchStats = async () => {
    try {
      const data = await orderService.getOrderStats();
      setStats(data);
    } catch (error) {
      console.error("Failed to fetch stats:", error);
    }
  };

  // Filter orders
  const filteredOrders = orders.filter((order) => {
    const matchesSearch =
      order.order_number.toLowerCase().includes(searchTerm.toLowerCase()) ||
      order.customers?.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      order.description?.toLowerCase().includes(searchTerm.toLowerCase());

    const matchesStatus =
      statusFilter === "all" || order.status === statusFilter;

    return matchesSearch && matchesStatus;
  });

  const handleCreateOrder = async (data) => {
    try {
      const order = await createOrder(data);

      // Add materials to the order
      if (data.materials && data.materials.length > 0) {
        for (const material of data.materials) {
          await orderService.addOrderMaterial({
            order_id: order.id,
            material_id: material.material_id,
            quantity_used: material.quantity_used,
            cost: material.cost,
          });
        }
      }

      setShowCreateModal(false);
      toast.success("Order created successfully!");
      fetchOrders();
    } catch (error) {
      toast.error("Failed to create order");
    }
  };

  const handleViewOrder = async (order) => {
    try {
      const fullOrder = await orderService.getOrderById(order.id);
      setViewingOrder(fullOrder);
    } catch (error) {
      toast.error("Failed to load order details");
    }
  };

  const handleEditOrder = (order) => {
    setEditingOrder(order);
    setViewingOrder(null);
  };

  const handleDeleteOrder = async (id) => {
    if (window.confirm("Are you sure you want to delete this order?")) {
      await deleteOrder(id);
    }
  };

  const handleStatusChange = async (orderId, newStatus, notes) => {
    await updateOrderStatus(orderId, newStatus, notes);
    // Refresh the order details
    const fullOrder = await orderService.getOrderById(orderId);
    setViewingOrder(fullOrder);
    fetchOrders();
  };

  if (loading && orders.length === 0) {
    return (
      <div className="flex items-center justify-center h-full">
        <div className="text-center">
          <div className="w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
          <p className="text-gray-600">Loading orders...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-6">
      {/* Header */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-3xl font-bold text-gray-900 mb-2">
            Order Management
          </h1>
          <p className="text-gray-600">Track and manage customer orders</p>
        </div>
        <Button onClick={() => setShowCreateModal(true)} icon={Plus}>
          Create Order
        </Button>
      </div>

      {/* Stats Cards */}
      {stats && (
        <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
          <Card>
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600 mb-1">Total Orders</p>
                <p className="text-3xl font-bold text-gray-900">
                  {stats.total}
                </p>
              </div>
              <div className="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
                <ShoppingCart className="text-blue-600" size={24} />
              </div>
            </div>
          </Card>

          <Card>
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600 mb-1">In Production</p>
                <p className="text-3xl font-bold text-gray-900">
                  {stats.byStatus?.production || 0}
                </p>
              </div>
              <div className="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
                <Clock className="text-yellow-600" size={24} />
              </div>
            </div>
          </Card>

          <Card>
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600 mb-1">This Month</p>
                <p className="text-3xl font-bold text-gray-900">
                  {stats.thisMonth}
                </p>
              </div>
              <div className="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                <TrendingUp className="text-purple-600" size={24} />
              </div>
            </div>
          </Card>

          <Card>
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-gray-600 mb-1">Total Revenue</p>
                <p className="text-3xl font-bold text-gray-900">
                  K{stats.totalRevenue.toFixed(0)}
                </p>
              </div>
              <div className="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                <TrendingUp className="text-green-600" size={24} />
              </div>
            </div>
          </Card>
        </div>
      )}

      {/* Search and Filter */}
      <Card>
        <div className="flex flex-col md:flex-row gap-4">
          {/* Search */}
          <div className="flex-1 relative">
            <Search
              className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"
              size={20}
            />
            <input
              type="search"
              placeholder="Search by order number, customer name, or description..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
            />
          </div>

          {/* Status Filter */}
          <div className="flex items-center gap-2">
            <Filter size={20} className="text-gray-500" />
            <select
              value={statusFilter}
              onChange={(e) => setStatusFilter(e.target.value)}
              className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent outline-none"
            >
              {STATUS_FILTERS.map((filter) => (
                <option key={filter.key} value={filter.key}>
                  {filter.label}
                </option>
              ))}
            </select>
          </div>
        </div>
      </Card>

      {/* Orders Grid */}
      {filteredOrders.length === 0 ? (
        <Card className="text-center py-12">
          <ShoppingCart className="mx-auto text-gray-400 mb-4" size={48} />
          <h3 className="text-xl font-semibold text-gray-900 mb-2">
            No orders found
          </h3>
          <p className="text-gray-600 mb-6">
            {searchTerm || statusFilter !== "all"
              ? "Try adjusting your search or filters"
              : "Get started by creating your first order"}
          </p>
          {!searchTerm && statusFilter === "all" && (
            <Button onClick={() => setShowCreateModal(true)} icon={Plus}>
              Create Your First Order
            </Button>
          )}
        </Card>
      ) : (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {filteredOrders.map((order) => (
            <OrderCard
              key={order.id}
              order={order}
              onView={handleViewOrder}
              onEdit={handleEditOrder}
              onDelete={handleDeleteOrder}
            />
          ))}
        </div>
      )}

      {/* Create Order Modal */}
      <Modal
        isOpen={showCreateModal}
        onClose={() => setShowCreateModal(false)}
        title="Create New Order"
        size="lg"
      >
        <CreateOrderForm
          onSubmit={handleCreateOrder}
          onCancel={() => setShowCreateModal(false)}
        />
      </Modal>

      {/* View Order Modal */}
      <Modal
        isOpen={!!viewingOrder}
        onClose={() => setViewingOrder(null)}
        title="Order Details"
        size="xl"
      >
        {viewingOrder && (
          <OrderDetailsView
            order={viewingOrder}
            onEdit={handleEditOrder}
            onStatusChange={handleStatusChange}
          />
        )}
      </Modal>

      {/* Edit Order Modal */}
      <Modal
        isOpen={!!editingOrder}
        onClose={() => setEditingOrder(null)}
        title="Edit Order"
        size="lg"
      >
        <CreateOrderForm
          order={editingOrder}
          onSubmit={async (data) => {
            // Handle order update
            toast.info("Order editing coming soon!");
            setEditingOrder(null);
          }}
          onCancel={() => setEditingOrder(null)}
        />
      </Modal>
    </div>
  );
}


import { supabase } from "../lib/supabase";
import { startOfMonth, endOfMonth, subMonths, format } from "date-fns";

export const analyticsService = {
  // Get revenue data for the last 6 months
  async getRevenueData() {
    const months = [];
    for (let i = 5; i >= 0; i--) {
      const date = subMonths(new Date(), i);
      const start = startOfMonth(date);
      const end = endOfMonth(date);

      const { data: orders } = await supabase
        .from("orders")
        .select("total_cost")
        .gte("order_date", start.toISOString())
        .lte("order_date", end.toISOString());

      const revenue =
        orders?.reduce(
          (sum, order) => sum + parseFloat(order.total_cost || 0),
          0
        ) || 0;

      months.push({
        month: format(date, "MMM yyyy"),
        revenue: parseFloat(revenue.toFixed(2)),
      });
    }

    return months;
  },

  // Get order status distribution
  async getOrderStatusData() {
    const { data: orders } = await supabase.from("orders").select("status");

    if (!orders) return [];

    const statusCount = {};
    orders.forEach((order) => {
      statusCount[order.status] = (statusCount[order.status] || 0) + 1;
    });

    return Object.entries(statusCount).map(([status, count]) => ({
      status,
      count,
    }));
  },

  // Get top materials used
  async getTopMaterialsUsed(limit = 10) {
    const { data: orderMaterials } = await supabase.from("order_materials")
      .select(`
        material_id,
        quantity_used,
        cost,
        materials (
          name,
          unit
        )
      `);

    if (!orderMaterials) return [];

    // Aggregate by material
    const materialMap = {};
    orderMaterials.forEach((item) => {
      const id = item.material_id;
      if (!materialMap[id]) {
        materialMap[id] = {
          name: item.materials?.name || "Unknown",
          unit: item.materials?.unit || "",
          quantity: 0,
          cost: 0,
        };
      }
      materialMap[id].quantity += parseFloat(item.quantity_used || 0);
      materialMap[id].cost += parseFloat(item.cost || 0);
    });

    // Convert to array and sort by quantity
    return Object.values(materialMap)
      .sort((a, b) => b.quantity - a.quantity)
      .slice(0, limit)
      .map((m) => ({
        name: m.name,
        quantity: parseFloat(m.quantity.toFixed(2)),
        cost: parseFloat(m.cost.toFixed(2)),
      }));
  },

  // Get employee productivity
  async getEmployeeProductivity() {
    const thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);

    // Get employees
    const { data: employees } = await supabase
      .from("employees")
      .select("id, name, role")
      .eq("active", true);

    if (!employees) return [];

    const productivity = await Promise.all(
      employees.map(async (employee) => {
        // Get total hours
        const { data: attendance } = await supabase
          .from("attendance")
          .select("hours_worked")
          .eq("employee_id", employee.id)
          .gte("date", thirtyDaysAgo.toISOString().split("T")[0]);

        const totalHours =
          attendance?.reduce(
            (sum, record) => sum + parseFloat(record.hours_worked || 0),
            0
          ) || 0;

        // Get completed orders (if tailor)
        const { data: orders } = await supabase
          .from("orders")
          .select("id")
          .eq("assigned_tailor_id", employee.id)
          .in("status", ["completed", "delivered"]);

        return {
          name: employee.name,
          hours: parseFloat(totalHours.toFixed(1)),
          orders: orders?.length || 0,
        };
      })
    );

    return productivity.filter((p) => p.hours > 0 || p.orders > 0);
  },

  // Get overall dashboard stats
  async getDashboardStats() {
    // Total revenue
    const { data: allOrders } = await supabase
      .from("orders")
      .select("total_cost, status, order_date");

    const totalRevenue =
      allOrders?.reduce(
        (sum, order) => sum + parseFloat(order.total_cost || 0),
        0
      ) || 0;

    // This month's revenue
    const thisMonthStart = startOfMonth(new Date());
    const thisMonthOrders =
      allOrders?.filter(
        (order) => new Date(order.order_date) >= thisMonthStart
      ) || [];
    const thisMonthRevenue = thisMonthOrders.reduce(
      (sum, order) => sum + parseFloat(order.total_cost || 0),
      0
    );

    // Low stock count
    // Low stock count: fetch materials and compute client-side since supabase filters don't support column-to-column comparison
    const { data: materials } = await supabase
      .from("materials")
      .select("id, stock_quantity, min_stock_level");
    const lowStock = (materials || []).filter(
      (m) =>
        parseFloat(m.stock_quantity || 0) <= parseFloat(m.min_stock_level || 0)
    );

    // Active orders
    const activeOrders =
      allOrders?.filter(
        (order) => !["delivered", "cancelled"].includes(order.status)
      ).length || 0;

    // Customer count
    const { data: customers } = await supabase.from("customers").select("id");

    return {
      totalRevenue: parseFloat(totalRevenue.toFixed(2)),
      thisMonthRevenue: parseFloat(thisMonthRevenue.toFixed(2)),
      lowStockCount: lowStock.length || 0,
      activeOrders,
      totalCustomers: customers?.length || 0,
      totalOrders: allOrders?.length || 0,
    };
  },
};


import { supabase } from "../lib/supabase";

export const authService = {
  // Sign up new user
  async signUp(email, password, fullName, role = "employee") {
    const { data, error } = await supabase.auth.signUp({
      email,
      password,
      options: {
        data: {
          full_name: fullName,
          role: role,
        },
      },
    });

    if (error) throw error;
    return data;
  },

  // Sign in
  async signIn(email, password) {
    const { data, error } = await supabase.auth.signInWithPassword({
      email,
      password,
    });

    if (error) throw error;
    return data;
  },

  // Sign out
  async signOut() {
    const { error } = await supabase.auth.signOut();
    if (error) throw error;
  },

  // Get current session
  async getSession() {
    const { data, error } = await supabase.auth.getSession();
    if (error) throw error;
    return data.session;
  },

  // Get current user
  async getCurrentUser() {
    const {
      data: { user },
      error,
    } = await supabase.auth.getUser();
    if (error) throw error;
    return user;
  },

  // Get user profile
  async getUserProfile(userId) {
    const { data, error } = await supabase
      .from("user_profiles")
      .select("*")
      .eq("id", userId)
      .single();

    if (error) throw error;
    return data;
  },

  // Update user profile
  async updateUserProfile(userId, updates) {
    const { data, error } = await supabase
      .from("user_profiles")
      .update(updates)
      .eq("id", userId)
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Get all users (admin only)
  async getAllUsers() {
    const { data, error } = await supabase
      .from("user_profiles")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) throw error;
    return data;
  },

  // Update user role (admin only)
  async updateUserRole(userId, role) {
    const { data, error } = await supabase
      .from("user_profiles")
      .update({ role })
      .eq("id", userId)
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Deactivate user (admin only)
  async deactivateUser(userId) {
    const { data, error } = await supabase
      .from("user_profiles")
      .update({ active: false })
      .eq("id", userId)
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Reset password
  async resetPassword(email) {
    const { error } = await supabase.auth.resetPasswordForEmail(email, {
      redirectTo: `${window.location.origin}/reset-password`,
    });

    if (error) throw error;
  },

  // Update password
  async updatePassword(newPassword) {
    const { error } = await supabase.auth.updateUser({
      password: newPassword,
    });

    if (error) throw error;
  },
};


import { supabase } from "../lib/supabase";

export const customerService = {
  // Get all customers
  async getAllCustomers() {
    const { data, error } = await supabase
      .from("customers")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) throw error;
    return data;
  },

  // Get customer by ID
  async getCustomerById(id) {
    const { data, error } = await supabase
      .from("customers")
      .select("*")
      .eq("id", id)
      .single();

    if (error) throw error;
    return data;
  },

  // Get customer with orders
  async getCustomerWithOrders(id) {
    const { data: customer, error: customerError } = await supabase
      .from("customers")
      .select("*")
      .eq("id", id)
      .single();

    if (customerError) throw customerError;

    const { data: orders, error: ordersError } = await supabase
      .from("orders")
      .select("*")
      .eq("customer_id", id)
      .order("created_at", { ascending: false });

    if (ordersError) throw ordersError;

    return {
      ...customer,
      orders: orders || [],
    };
  },

  // Add new customer
  async addCustomer(customer) {
    const { data, error } = await supabase
      .from("customers")
      .insert([customer])
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Update customer
  async updateCustomer(id, updates) {
    const { data, error } = await supabase
      .from("customers")
      .update(updates)
      .eq("id", id)
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Delete customer
  async deleteCustomer(id) {
    const { error } = await supabase.from("customers").delete().eq("id", id);

    if (error) throw error;
  },

  // Update measurements
  async updateMeasurements(id, measurements) {
    const { data, error } = await supabase
      .from("customers")
      .update({ measurements })
      .eq("id", id)
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Search customers
  async searchCustomers(searchTerm) {
    const { data, error } = await supabase
      .from("customers")
      .select("*")
      .or(
        `name.ilike.%${searchTerm}%,phone.ilike.%${searchTerm}%,email.ilike.%${searchTerm}%`
      )
      .order("created_at", { ascending: false });

    if (error) throw error;
    return data;
  },

  // Get customer statistics
  async getCustomerStats(customerId) {
    const { data: orders } = await supabase
      .from("orders")
      .select("total_cost, status, created_at")
      .eq("customer_id", customerId);

    if (!orders) return null;

    const stats = {
      totalOrders: orders.length,
      totalSpent: orders.reduce(
        (sum, o) => sum + parseFloat(o.total_cost || 0),
        0
      ),
      completedOrders: orders.filter((o) => o.status === "delivered").length,
      activeOrders: orders.filter(
        (o) => !["delivered", "cancelled"].includes(o.status)
      ).length,
      lastOrderDate: orders.length > 0 ? orders[0].created_at : null,
    };

    return stats;
  },
};


import { supabase } from "../lib/supabase";

export const dashboardService = {
  async getDashboardStats() {
    try {
      const today = new Date();
      const todayString = today.toISOString().split("T")[0];

      const [
        { data: orders },
        { data: customers },
        { data: materials },
        { data: employees },
        { data: todayAttendance },
      ] = await Promise.all([
        supabase.from("orders").select("*"),
        supabase.from("customers").select("*"),
        supabase.from("materials").select("*"),
        supabase.from("employees").select("*").eq("active", true),
        supabase
          .from("attendance")
          .select("*, employees(name, role)")
          .eq("date", todayString),
      ]);

      const orderStats = this.calculateOrderStats(orders || []);
      const inventoryStats = this.calculateInventoryStats(materials || []);
      const employeeStats = this.calculateEmployeeStats(todayAttendance || []);
      const revenueStats = this.calculateRevenueStats(orders || []);

      return {
        orders: orderStats,
        inventory: inventoryStats,
        employees: employeeStats,
        revenue: revenueStats,
        customers: {
          total: customers?.length || 0,
          withMeasurements:
            customers?.filter((c) => c.measurements).length || 0,
          newThisMonth:
            customers?.filter((c) => {
              const created = new Date(c.created_at);
              const now = new Date();
              return (
                created.getMonth() === now.getMonth() &&
                created.getFullYear() === now.getFullYear()
              );
            }).length || 0,
        },
      };
    } catch (error) {
      console.error("Error fetching dashboard stats:", error);
      throw error;
    }
  },

  calculateOrderStats(orders) {
    const now = new Date();
    const thisMonth = now.getMonth();
    const thisYear = now.getFullYear();
    const lastMonth = thisMonth === 0 ? 11 : thisMonth - 1;
    const lastMonthYear = thisMonth === 0 ? thisYear - 1 : thisYear;

    const statusCounts = {
      enquiry: 0,
      contacted: 0,
      measurements: 0,
      production: 0,
      fitting: 0,
      completed: 0,
      delivered: 0,
      cancelled: 0,
    };

    let totalRevenue = 0;
    let thisMonthOrders = 0;
    let lastMonthOrders = 0;
    let thisMonthRevenue = 0;
    let pendingBalance = 0;

    orders.forEach((order) => {
      const status = order.status?.toLowerCase() || "enquiry";
      statusCounts[status] = (statusCounts[status] || 0) + 1;
      totalRevenue += parseFloat(order.total_cost || 0);
      pendingBalance += parseFloat(order.balance || 0);

      const orderDate = new Date(order.created_at);
      if (
        orderDate.getMonth() === thisMonth &&
        orderDate.getFullYear() === thisYear
      ) {
        thisMonthOrders++;
        thisMonthRevenue += parseFloat(order.total_cost || 0);
      }
      if (
        orderDate.getMonth() === lastMonth &&
        orderDate.getFullYear() === lastMonthYear
      ) {
        lastMonthOrders++;
      }
    });

    const orderGrowth =
      lastMonthOrders === 0
        ? 0
        : ((thisMonthOrders - lastMonthOrders) / lastMonthOrders) * 100;

    const activeOrders = orders.filter(
      (o) => !["delivered", "cancelled"].includes(o.status?.toLowerCase())
    ).length;

    return {
      total: orders.length,
      byStatus: statusCounts,
      totalRevenue,
      thisMonthOrders,
      thisMonthRevenue,
      pendingBalance,
      orderGrowth: orderGrowth.toFixed(1),
      activeOrders,
    };
  },

  calculateInventoryStats(materials) {
    let totalValue = 0;
    let lowStockCount = 0;
    const categories = {};

    materials.forEach((material) => {
      const stockQty = parseFloat(material.stock_quantity || 0);
      const minStock = parseFloat(material.min_stock_level || 0);
      const costPerUnit = parseFloat(material.cost_per_unit || 0);

      totalValue += stockQty * costPerUnit;

      if (stockQty <= minStock) {
        lowStockCount++;
      }

      categories[material.category] = (categories[material.category] || 0) + 1;
    });

    return {
      totalMaterials: materials.length,
      totalValue,
      lowStockCount,
      categories,
    };
  },

  calculateEmployeeStats(attendance) {
    const clockedIn = attendance.filter(
      (a) => a.clock_in && !a.clock_out
    ).length;
    const completed = attendance.filter((a) => a.clock_out).length;
    const totalHours = attendance.reduce(
      (sum, a) => sum + parseFloat(a.hours_worked || 0),
      0
    );

    return {
      clockedIn,
      completed,
      totalToday: attendance.length,
      totalHours: totalHours.toFixed(1),
    };
  },

  calculateRevenueStats(orders) {
    const now = new Date();
    const currentYear = now.getFullYear();
    const currentMonth = now.getMonth();
    const monthlyRevenue = Array(12).fill(0);

    orders.forEach((order) => {
      const orderDate = new Date(order.created_at);
      if (orderDate.getFullYear() === currentYear) {
        const month = orderDate.getMonth();
        monthlyRevenue[month] += parseFloat(order.total_cost || 0);
      }
    });

    const revenueByStatus = {};
    orders.forEach((order) => {
      const status = order.status?.toLowerCase() || "enquiry";
      if (!revenueByStatus[status]) {
        revenueByStatus[status] = 0;
      }
      revenueByStatus[status] += parseFloat(order.total_cost || 0);
    });

    return {
      monthlyRevenue,
      revenueByStatus,
      currentMonthRevenue: monthlyRevenue[currentMonth],
    };
  },

  async getRecentActivity() {
    const { data: recentOrders } = await supabase
      .from("orders")
      .select(
        `
        *,
        customers (name, phone)
      `
      )
      .order("created_at", { ascending: false })
      .limit(5);

    const { data: allMaterials } = await supabase.from("materials").select("*");

    const lowStockMaterials = (allMaterials || [])
      .filter(
        (m) => parseFloat(m.stock_quantity) <= parseFloat(m.min_stock_level)
      )
      .slice(0, 5);

    return {
      recentOrders: recentOrders || [],
      lowStockMaterials: lowStockMaterials || [],
    };
  },
};


import { supabase } from "../lib/supabase";

export const employeeService = {
  // Get all employees
  async getAllEmployees() {
    const { data, error } = await supabase
      .from("employees")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) throw error;
    return data;
  },

  // Get active employees only
  async getActiveEmployees() {
    const { data, error } = await supabase
      .from("employees")
      .select("*")
      .eq("active", true)
      .order("name");

    if (error) throw error;
    return data;
  },

  // Get employee by ID
  async getEmployeeById(id) {
    const { data, error } = await supabase
      .from("employees")
      .select("*")
      .eq("id", id)
      .single();

    if (error) throw error;
    return data;
  },

  // Add new employee
  async addEmployee(employee) {
    const { data, error } = await supabase
      .from("employees")
      .insert([employee])
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Update employee
  async updateEmployee(id, updates) {
    const { data, error } = await supabase
      .from("employees")
      .update(updates)
      .eq("id", id)
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Delete employee (soft delete - set active to false)
  async deleteEmployee(id) {
    const { data, error } = await supabase
      .from("employees")
      .update({ active: false })
      .eq("id", id)
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Clock in
  async clockIn(employeeId, notes = "") {
    const today = new Date().toISOString().split("T")[0];

    // Check if already clocked in today
    const { data: existing } = await supabase
      .from("attendance")
      .select("*")
      .eq("employee_id", employeeId)
      .eq("date", today)
      .single();

    if (existing && existing.clock_in && !existing.clock_out) {
      throw new Error("Already clocked in for today");
    }

    if (existing && existing.clock_out) {
      throw new Error("Already completed shift for today");
    }

    const { data, error } = await supabase
      .from("attendance")
      .insert([
        {
          employee_id: employeeId,
          date: today,
          clock_in: new Date().toISOString(),
          notes: notes,
        },
      ])
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Clock out
  async clockOut(employeeId, notes = "") {
    const today = new Date().toISOString().split("T")[0];

    // Get today's attendance record
    const { data: attendance } = await supabase
      .from("attendance")
      .select("*")
      .eq("employee_id", employeeId)
      .eq("date", today)
      .single();

    if (!attendance) {
      throw new Error("No clock-in record found for today");
    }

    if (attendance.clock_out) {
      throw new Error("Already clocked out for today");
    }

    // Calculate hours worked
    const clockIn = new Date(attendance.clock_in);
    const clockOut = new Date();
    const hoursWorked = (clockOut - clockIn) / (1000 * 60 * 60);

    const { data, error } = await supabase
      .from("attendance")
      .update({
        clock_out: clockOut.toISOString(),
        hours_worked: hoursWorked.toFixed(2),
        notes: notes || attendance.notes,
      })
      .eq("id", attendance.id)
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Get attendance records for an employee
  async getEmployeeAttendance(employeeId, startDate = null, endDate = null) {
    let query = supabase
      .from("attendance")
      .select("*")
      .eq("employee_id", employeeId)
      .order("date", { ascending: false });

    if (startDate) {
      query = query.gte("date", startDate);
    }
    if (endDate) {
      query = query.lte("date", endDate);
    }

    const { data, error } = await query;
    if (error) throw error;
    return data;
  },

  // Get today's attendance for all employees
  async getTodayAttendance() {
    const today = new Date().toISOString().split("T")[0];

    const { data, error } = await supabase
      .from("attendance")
      .select(
        `
        *,
        employees (
          id,
          name,
          role,
          email
        )
      `
      )
      .eq("date", today)
      .order("clock_in", { ascending: false });

    if (error) throw error;
    return data;
  },

  // Get attendance status for an employee today
  async getTodayStatus(employeeId) {
    const today = new Date().toISOString().split("T")[0];

    const { data, error } = await supabase
      .from("attendance")
      .select("*")
      .eq("employee_id", employeeId)
      .eq("date", today)
      .single();

    if (error && error.code !== "PGRST116") throw error; // PGRST116 = no rows returned
    return data;
  },

  // Get attendance summary for date range
  async getAttendanceSummary(startDate, endDate) {
    const { data, error } = await supabase
      .from("attendance")
      .select(
        `
        *,
        employees (
          id,
          name,
          role
        )
      `
      )
      .gte("date", startDate)
      .lte("date", endDate)
      .order("date", { ascending: false });

    if (error) throw error;
    return data;
  },

  // Calculate total hours for employee in date range
  async calculateTotalHours(employeeId, startDate, endDate) {
    const { data, error } = await supabase
      .from("attendance")
      .select("hours_worked")
      .eq("employee_id", employeeId)
      .gte("date", startDate)
      .lte("date", endDate)
      .not("hours_worked", "is", null);

    if (error) throw error;

    const totalHours = data.reduce(
      (sum, record) => sum + parseFloat(record.hours_worked || 0),
      0
    );

    return totalHours;
  },
};


import { supabase } from "../lib/supabase";

export const inventoryService = {
  // Get all materials
  async getAllMaterials() {
    const { data, error } = await supabase
      .from("materials")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) throw error;
    return data;
  },

  // Get material by ID
  async getMaterialById(id) {
    const { data, error } = await supabase
      .from("materials")
      .select("*")
      .eq("id", id)
      .single();

    if (error) throw error;
    return data;
  },

  // Add new material
  async addMaterial(material) {
    const { data, error } = await supabase
      .from("materials")
      .insert([material])
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Update material
  async updateMaterial(id, updates) {
    const { data, error } = await supabase
      .from("materials")
      .update(updates)
      .eq("id", id)
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Delete material
  async deleteMaterial(id) {
    const { error } = await supabase.from("materials").delete().eq("id", id);

    if (error) throw error;
  },

  // Update stock quantity
  async updateStock(id, quantity, operation = "add") {
    // Get current stock
    const { data: material } = await supabase
      .from("materials")
      .select("stock_quantity")
      .eq("id", id)
      .single();

    const newQuantity =
      operation === "add"
        ? parseFloat(material.stock_quantity) + parseFloat(quantity)
        : parseFloat(material.stock_quantity) - parseFloat(quantity);

    const { data, error } = await supabase
      .from("materials")
      .update({
        stock_quantity: newQuantity,
        last_restocked:
          operation === "add" ? new Date().toISOString() : undefined,
      })
      .eq("id", id)
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Get low stock materials
  async getLowStockMaterials() {
    // Supabase REST does not support column-to-column comparisons in filters.
    // Fetch materials and compute low-stock client-side.
    const { data: materials, error } = await supabase
      .from("materials")
      .select("*")
      .order("created_at", { ascending: false });

    if (error) throw error;

    const lowStock = (materials || []).filter(
      (m) =>
        parseFloat(m.stock_quantity || 0) <= parseFloat(m.min_stock_level || 0)
    );

    return lowStock;
  },

  // Search materials
  async searchMaterials(searchTerm) {
    const { data, error } = await supabase
      .from("materials")
      .select("*")
      .or(
        `name.ilike.%${searchTerm}%,category.ilike.%${searchTerm}%,supplier.ilike.%${searchTerm}%`
      )
      .order("created_at", { ascending: false });

    if (error) throw error;
    return data;
  },

  // Get materials by category
  async getMaterialsByCategory(category) {
    const { data, error } = await supabase
      .from("materials")
      .select("*")
      .eq("category", category)
      .order("name");

    if (error) throw error;
    return data;
  },
};


import { supabase } from "../lib/supabase";
import { inventoryService } from "./inventoryService";

export const orderService = {
  // Get all orders
  async getAllOrders() {
    const { data, error } = await supabase
      .from("orders")
      .select(
        `
        *,
        customers (
          id,
          name,
          phone,
          email
        ),
        employees:assigned_tailor_id (
          id,
          name,
          role
        )
      `
      )
      .order("created_at", { ascending: false });

    if (error) throw error;
    return data;
  },

  // Get order by ID with all relations
  async getOrderById(id) {
    const { data, error } = await supabase
      .from("orders")
      .select(
        `
        *,
        customers (
          id,
          name,
          phone,
          email,
          measurements
        ),
        employees:assigned_tailor_id (
          id,
          name,
          role
        )
      `
      )
      .eq("id", id)
      .single();

    if (error) throw error;

    // Get order items
    const { data: items } = await supabase
      .from("order_items")
      .select("*")
      .eq("order_id", id);

    // Get order materials
    const { data: materials } = await supabase
      .from("order_materials")
      .select(
        `
        *,
        materials (
          id,
          name,
          unit,
          cost_per_unit
        )
      `
      )
      .eq("order_id", id);

    // Get order timeline
    const { data: timeline } = await supabase
      .from("order_timeline")
      .select("*")
      .eq("order_id", id)
      .order("created_at", { ascending: true });

    return {
      ...data,
      items: items || [],
      materials: materials || [],
      timeline: timeline || [],
    };
  },

  // Create new order
  async createOrder(orderData) {
    const { data: order, error } = await supabase
      .from("orders")
      .insert([
        {
          customer_id: orderData.customer_id,
          status: "enquiry",
          order_date: new Date().toISOString(),
          due_date: orderData.due_date,
          total_cost: orderData.total_cost,
          deposit: orderData.deposit || 0,
          balance: orderData.total_cost - (orderData.deposit || 0),
          description: orderData.description,
          notes: orderData.notes,
          assigned_tailor_id: orderData.assigned_tailor_id,
        },
      ])
      .select()
      .single();

    if (error) throw error;

    // Add initial timeline entry
    await supabase.from("order_timeline").insert([
      {
        order_id: order.id,
        status: "enquiry",
        notes: "Order created",
      },
    ]);

    return order;
  },

  // Add order item
  async addOrderItem(orderItem) {
    const { data, error } = await supabase
      .from("order_items")
      .insert([orderItem])
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Add material to order
  async addOrderMaterial(orderMaterial) {
    const { data, error } = await supabase
      .from("order_materials")
      .insert([orderMaterial])
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Deduct materials from inventory
  async deductMaterials(orderId) {
    // Get order materials
    const { data: materials } = await supabase
      .from("order_materials")
      .select("material_id, quantity_used")
      .eq("order_id", orderId);

    if (!materials) return;

    // Deduct each material from inventory
    for (const material of materials) {
      await inventoryService.updateStock(
        material.material_id,
        material.quantity_used,
        "subtract"
      );
    }
  },

  // Update order status
  async updateOrderStatus(orderId, status, notes = "") {
    // Update order
    const { data, error } = await supabase
      .from("orders")
      .update({ status })
      .eq("id", orderId)
      .select()
      .single();

    if (error) throw error;

    // Add timeline entry
    await supabase.from("order_timeline").insert([
      {
        order_id: orderId,
        status,
        notes,
      },
    ]);

    // If status is 'production', deduct materials
    if (status === "production") {
      await this.deductMaterials(orderId);
    }

    return data;
  },

  // Update order
  async updateOrder(id, updates) {
    const { data, error } = await supabase
      .from("orders")
      .update(updates)
      .eq("id", id)
      .select()
      .single();

    if (error) throw error;
    return data;
  },

  // Delete order
  async deleteOrder(id) {
    const { error } = await supabase.from("orders").delete().eq("id", id);

    if (error) throw error;
  },

  // Get orders by status
  async getOrdersByStatus(status) {
    const { data, error } = await supabase
      .from("orders")
      .select(
        `
        *,
        customers (
          id,
          name,
          phone
        )
      `
      )
      .eq("status", status)
      .order("created_at", { ascending: false });

    if (error) throw error;
    return data;
  },

  // Get orders by customer
  async getOrdersByCustomer(customerId) {
    const { data, error } = await supabase
      .from("orders")
      .select("*")
      .eq("customer_id", customerId)
      .order("created_at", { ascending: false });

    if (error) throw error;
    return data;
  },

  // Search orders
  async searchOrders(searchTerm) {
    const { data, error } = await supabase
      .from("orders")
      .select(
        `
        *,
        customers (
          id,
          name,
          phone
        )
      `
      )
      .or(
        `order_number.ilike.%${searchTerm}%,description.ilike.%${searchTerm}%`
      )
      .order("created_at", { ascending: false });

    if (error) throw error;
    return data;
  },

  // Get order statistics
  async getOrderStats() {
    const { data: orders } = await supabase
      .from("orders")
      .select("status, total_cost, created_at");

    if (!orders) return null;

    const stats = {
      total: orders.length,
      byStatus: {},
      totalRevenue: 0,
      thisMonth: 0,
    };

    const thisMonth = new Date().getMonth();
    const thisYear = new Date().getFullYear();

    orders.forEach((order) => {
      // Count by status
      stats.byStatus[order.status] = (stats.byStatus[order.status] || 0) + 1;

      // Total revenue
      stats.totalRevenue += parseFloat(order.total_cost || 0);

      // This month
      const orderDate = new Date(order.created_at);
      if (
        orderDate.getMonth() === thisMonth &&
        orderDate.getFullYear() === thisYear
      ) {
        stats.thisMonth += 1;
      }
    });

    return stats;
  },
};


import { create } from "zustand";
import { authService } from "../services/authService";
import { supabase } from "../lib/supabase";
import toast from "react-hot-toast";

export const useAuthStore = create((set, get) => ({
  user: null,
  profile: null,
  session: null,
  loading: true,
  initialized: false,

  // Initialize auth state
  initialize: async () => {
    try {
      const session = await authService.getSession();

      if (session?.user) {
        const profile = await authService.getUserProfile(session.user.id);
        set({
          user: session.user,
          profile,
          session,
          loading: false,
          initialized: true,
        });
      } else {
        set({
          user: null,
          profile: null,
          session: null,
          loading: false,
          initialized: true,
        });
      }

      // Listen for auth changes
      supabase.auth.onAuthStateChange(async (event, session) => {
        if (event === "SIGNED_IN" && session?.user) {
          const profile = await authService.getUserProfile(session.user.id);
          set({ user: session.user, profile, session });
        } else if (event === "SIGNED_OUT") {
          set({ user: null, profile: null, session: null });
        }
      });
    } catch (error) {
      console.error("Auth initialization error:", error);
      set({ loading: false, initialized: true });
    }
  },

  // Sign in
  signIn: async (email, password) => {
    try {
      const { user, session } = await authService.signIn(email, password);
      const profile = await authService.getUserProfile(user.id);

      if (!profile.active) {
        await authService.signOut();
        throw new Error(
          "Your account has been deactivated. Please contact an administrator."
        );
      }

      set({ user, profile, session });
      toast.success("Welcome back!");
      return { user, profile };
    } catch (error) {
      toast.error(error.message || "Failed to sign in");
      throw error;
    }
  },

  // Sign up
  signUp: async (email, password, fullName, role = "employee") => {
    try {
      const data = await authService.signUp(email, password, fullName, role);
      toast.success("Account created! Please check your email to verify.");
      return data;
    } catch (error) {
      toast.error(error.message || "Failed to sign up");
      throw error;
    }
  },

  // Sign out
  signOut: async () => {
    try {
      await authService.signOut();
      set({ user: null, profile: null, session: null });
      toast.success("Signed out successfully");
    } catch (error) {
      toast.error("Failed to sign out");
      throw error;
    }
  },

  // Update profile
  updateProfile: async (updates) => {
    const { user } = get();
    if (!user) return;

    try {
      const updatedProfile = await authService.updateUserProfile(
        user.id,
        updates
      );
      set({ profile: updatedProfile });
      toast.success("Profile updated successfully");
      return updatedProfile;
    } catch (error) {
      toast.error("Failed to update profile");
      throw error;
    }
  },

  // Check if user has role
  hasRole: (role) => {
    const { profile } = get();
    return profile?.role === role;
  },

  // Check if user has any of the roles
  hasAnyRole: (roles) => {
    const { profile } = get();
    return roles.includes(profile?.role);
  },

  // Check if user is admin
  isAdmin: () => {
    const { profile } = get();
    return profile?.role === "admin";
  },

  // Check if user is manager
  isManager: () => {
    const { profile } = get();
    return profile?.role === "manager";
  },
}));


import { create } from "zustand";
import { customerService } from "../services/customerService";
import toast from "react-hot-toast";

export const useCustomerStore = create((set, get) => ({
  customers: [],
  selectedCustomer: null,
  loading: false,
  error: null,

  // Fetch all customers
  fetchCustomers: async () => {
    set({ loading: true, error: null });
    try {
      const customers = await customerService.getAllCustomers();
      set({ customers, loading: false });
    } catch (error) {
      set({ error: error.message, loading: false });
      toast.error("Failed to fetch customers");
    }
  },

  // Fetch customer with orders
  fetchCustomerWithOrders: async (id) => {
    set({ loading: true });
    try {
      const customer = await customerService.getCustomerWithOrders(id);
      set({ selectedCustomer: customer, loading: false });
      return customer;
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to fetch customer details");
      throw error;
    }
  },

  // Add customer
  addCustomer: async (customer) => {
    set({ loading: true });
    try {
      const newCustomer = await customerService.addCustomer(customer);
      set((state) => ({
        customers: [newCustomer, ...state.customers],
        loading: false,
      }));
      toast.success("Customer added successfully!");
      return newCustomer;
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to add customer");
      throw error;
    }
  },

  // Update customer
  updateCustomer: async (id, updates) => {
    set({ loading: true });
    try {
      const updatedCustomer = await customerService.updateCustomer(id, updates);
      set((state) => ({
        customers: state.customers.map((c) =>
          c.id === id ? updatedCustomer : c
        ),
        selectedCustomer:
          state.selectedCustomer?.id === id
            ? updatedCustomer
            : state.selectedCustomer,
        loading: false,
      }));
      toast.success("Customer updated successfully!");
      return updatedCustomer;
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to update customer");
      throw error;
    }
  },

  // Delete customer
  deleteCustomer: async (id) => {
    set({ loading: true });
    try {
      await customerService.deleteCustomer(id);
      set((state) => ({
        customers: state.customers.filter((c) => c.id !== id),
        loading: false,
      }));
      toast.success("Customer deleted successfully!");
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to delete customer");
      throw error;
    }
  },

  // Update measurements
  updateMeasurements: async (id, measurements) => {
    try {
      const updatedCustomer = await customerService.updateMeasurements(
        id,
        measurements
      );
      set((state) => ({
        customers: state.customers.map((c) =>
          c.id === id ? updatedCustomer : c
        ),
        selectedCustomer:
          state.selectedCustomer?.id === id
            ? updatedCustomer
            : state.selectedCustomer,
      }));
      toast.success("Measurements updated successfully!");
      return updatedCustomer;
    } catch (error) {
      toast.error("Failed to update measurements");
      throw error;
    }
  },

  // Set selected customer
  setSelectedCustomer: (customer) => set({ selectedCustomer: customer }),

  // Clear selected customer
  clearSelectedCustomer: () => set({ selectedCustomer: null }),
}));


import { create } from "zustand";
import { employeeService } from "../services/employeeService";
import toast from "react-hot-toast";

export const useEmployeeStore = create((set, get) => ({
  employees: [],
  todayAttendance: [],
  loading: false,
  error: null,
  selectedEmployee: null,

  // Fetch all employees
  fetchEmployees: async () => {
    set({ loading: true, error: null });
    try {
      const employees = await employeeService.getAllEmployees();
      set({ employees, loading: false });
    } catch (error) {
      set({ error: error.message, loading: false });
      toast.error("Failed to fetch employees");
    }
  },

  // Fetch today's attendance
  fetchTodayAttendance: async () => {
    try {
      const attendance = await employeeService.getTodayAttendance();
      set({ todayAttendance: attendance });
    } catch (error) {
      toast.error("Failed to fetch attendance");
    }
  },

  // Add employee
  addEmployee: async (employee) => {
    set({ loading: true });
    try {
      const newEmployee = await employeeService.addEmployee(employee);
      set((state) => ({
        employees: [newEmployee, ...state.employees],
        loading: false,
      }));
      toast.success("Employee added successfully!");
      return newEmployee;
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to add employee");
      throw error;
    }
  },

  // Update employee
  updateEmployee: async (id, updates) => {
    set({ loading: true });
    try {
      const updatedEmployee = await employeeService.updateEmployee(id, updates);
      set((state) => ({
        employees: state.employees.map((e) =>
          e.id === id ? updatedEmployee : e
        ),
        loading: false,
      }));
      toast.success("Employee updated successfully!");
      return updatedEmployee;
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to update employee");
      throw error;
    }
  },

  // Delete employee
  deleteEmployee: async (id) => {
    set({ loading: true });
    try {
      await employeeService.deleteEmployee(id);
      set((state) => ({
        employees: state.employees.map((e) =>
          e.id === id ? { ...e, active: false } : e
        ),
        loading: false,
      }));
      toast.success("Employee deactivated successfully!");
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to deactivate employee");
      throw error;
    }
  },

  // Clock in
  clockIn: async (employeeId, notes) => {
    try {
      await employeeService.clockIn(employeeId, notes);
      // Refresh today's attendance
      await get().fetchTodayAttendance();
      toast.success("Clocked in successfully!");
    } catch (error) {
      toast.error(error.message || "Failed to clock in");
      throw error;
    }
  },

  // Clock out
  clockOut: async (employeeId, notes) => {
    try {
      await employeeService.clockOut(employeeId, notes);
      // Refresh today's attendance
      await get().fetchTodayAttendance();
      toast.success("Clocked out successfully!");
    } catch (error) {
      toast.error(error.message || "Failed to clock out");
      throw error;
    }
  },

  // Set selected employee
  setSelectedEmployee: (employee) => set({ selectedEmployee: employee }),

  // Clear selected employee
  clearSelectedEmployee: () => set({ selectedEmployee: null }),
}));


import { create } from "zustand";
import { inventoryService } from "../services/inventoryService";
import toast from "react-hot-toast";

export const useInventoryStore = create((set, get) => ({
  materials: [],
  loading: false,
  error: null,
  selectedMaterial: null,

  // Fetch all materials
  fetchMaterials: async () => {
    set({ loading: true, error: null });
    try {
      const materials = await inventoryService.getAllMaterials();
      set({ materials, loading: false });
    } catch (error) {
      set({ error: error.message, loading: false });
      toast.error("Failed to fetch materials");
    }
  },

  // Add material
  addMaterial: async (material) => {
    set({ loading: true });
    try {
      const newMaterial = await inventoryService.addMaterial(material);
      set((state) => ({
        materials: [newMaterial, ...state.materials],
        loading: false,
      }));
      toast.success("Material added successfully!");
      return newMaterial;
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to add material");
      throw error;
    }
  },

  // Update material
  updateMaterial: async (id, updates) => {
    set({ loading: true });
    try {
      const updatedMaterial = await inventoryService.updateMaterial(
        id,
        updates
      );
      set((state) => ({
        materials: state.materials.map((m) =>
          m.id === id ? updatedMaterial : m
        ),
        loading: false,
      }));
      toast.success("Material updated successfully!");
      return updatedMaterial;
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to update material");
      throw error;
    }
  },

  // Delete material
  deleteMaterial: async (id) => {
    set({ loading: true });
    try {
      await inventoryService.deleteMaterial(id);
      set((state) => ({
        materials: state.materials.filter((m) => m.id !== id),
        loading: false,
      }));
      toast.success("Material deleted successfully!");
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to delete material");
      throw error;
    }
  },

  // Update stock
  updateStock: async (id, quantity, operation) => {
    try {
      const updatedMaterial = await inventoryService.updateStock(
        id,
        quantity,
        operation
      );
      set((state) => ({
        materials: state.materials.map((m) =>
          m.id === id ? updatedMaterial : m
        ),
      }));
      toast.success(
        `Stock ${operation === "add" ? "added" : "deducted"} successfully!`
      );
      return updatedMaterial;
    } catch (error) {
      toast.error("Failed to update stock");
      throw error;
    }
  },

  // Set selected material
  setSelectedMaterial: (material) => set({ selectedMaterial: material }),

  // Clear selected material
  clearSelectedMaterial: () => set({ selectedMaterial: null }),
}));


import { create } from "zustand";
import { orderService } from "../services/orderService";
import toast from "react-hot-toast";

export const useOrderStore = create((set, get) => ({
  orders: [],
  selectedOrder: null,
  loading: false,
  error: null,

  // Fetch all orders
  fetchOrders: async () => {
    set({ loading: true, error: null });
    try {
      const orders = await orderService.getAllOrders();
      set({ orders, loading: false });
    } catch (error) {
      set({ error: error.message, loading: false });
      toast.error("Failed to fetch orders");
    }
  },

  // Fetch order by ID
  fetchOrderById: async (id) => {
    set({ loading: true });
    try {
      const order = await orderService.getOrderById(id);
      set({ selectedOrder: order, loading: false });
      return order;
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to fetch order details");
      throw error;
    }
  },

  // Create order
  createOrder: async (orderData) => {
    set({ loading: true });
    try {
      const newOrder = await orderService.createOrder(orderData);
      set((state) => ({
        orders: [newOrder, ...state.orders],
        loading: false,
      }));
      toast.success(`Order ${newOrder.order_number} created successfully!`);
      return newOrder;
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to create order");
      throw error;
    }
  },

  // Update order status
  updateOrderStatus: async (orderId, status, notes) => {
    try {
      const updatedOrder = await orderService.updateOrderStatus(
        orderId,
        status,
        notes
      );
      set((state) => ({
        orders: state.orders.map((o) =>
          o.id === orderId ? { ...o, status } : o
        ),
        selectedOrder:
          state.selectedOrder?.id === orderId
            ? { ...state.selectedOrder, status }
            : state.selectedOrder,
      }));
      toast.success("Order status updated successfully!");
      return updatedOrder;
    } catch (error) {
      toast.error("Failed to update order status");
      throw error;
    }
  },

  // Update order
  updateOrder: async (id, updates) => {
    set({ loading: true });
    try {
      const updatedOrder = await orderService.updateOrder(id, updates);
      set((state) => ({
        orders: state.orders.map((o) =>
          o.id === id ? { ...updatedOrder, ...o } : o
        ),
        loading: false,
      }));
      toast.success("Order updated successfully!");
      return updatedOrder;
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to update order");
      throw error;
    }
  },

  // Delete order
  deleteOrder: async (id) => {
    set({ loading: true });
    try {
      await orderService.deleteOrder(id);
      set((state) => ({
        orders: state.orders.filter((o) => o.id !== id),
        loading: false,
      }));
      toast.success("Order deleted successfully!");
    } catch (error) {
      set({ loading: false });
      toast.error("Failed to delete order");
      throw error;
    }
  },

  // Set selected order
  setSelectedOrder: (order) => set({ selectedOrder: order }),

  // Clear selected order
  clearSelectedOrder: () => set({ selectedOrder: null }),
}));


